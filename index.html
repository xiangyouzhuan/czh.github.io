<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="程曾欢">
<title>系统工程师实战</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; border: 1px dashed #2f6fab;}

pre {border: 1px dashed gray;}

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed;}

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.listingblock pre:not(.highlight) {color: white; background: #002b36; }

.literalblock pre, .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
  thead { display: table-header-group; }
  svg { max-width: 100%; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }

</style>
<link rel="stylesheet" href="css/font-awesome.css">
<link rel="stylesheet" href="css/github.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>系统工程师实战</h1>
<div class="details">
<span id="author" class="author">程曾欢</span><br>
<span id="email" class="email"><a href="mailto:xiangyouzhuan2018@gmail.com">xiangyouzhuan2018@gmail.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_Docker_chapter">1. Ceph</a>
<ul class="sectlevel2">
<li><a href="#_搭建ceph_cluster">1.1. 搭建Ceph Cluster</a></li>
<li><a href="#_部署cephfs">1.2. 部署CephFS</a></li>
<li><a href="#_部署cephrwg">1.3. 部署CephRWG</a>
<ul class="sectlevel3">
<li><a href="#_打标签">1.3.1. 打标签</a></li>
<li><a href="#_使用s3">1.3.2. 使用S3</a></li>
<li><a href="#_使用swift">1.3.3. 使用swift</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_git">2. Git</a>
<ul class="sectlevel2">
<li><a href="#_在服务器上搭建git">2.1. 在服务器上搭建Git</a>
<ul class="sectlevel3">
<li><a href="#_从已有仓库克隆">2.1.1. 从已有仓库克隆</a></li>
<li><a href="#_创建dir初始化为空仓库">2.1.2. 创建dir,初始化为空仓库</a></li>
<li><a href="#_用户clonepush">2.1.3. 用户clone/push</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_gitlab">3. GitLab</a>
<ul class="sectlevel2">
<li><a href="#_新增gitlab_yum仓库">3.1. 新增GitLab Yum仓库</a>
<ul class="sectlevel3">
<li><a href="#_添加yum仓库">3.1.1. 添加Yum仓库</a></li>
<li><a href="#_列出gitlab的仓库列表">3.1.2. 列出GitLab的仓库列表</a></li>
<li><a href="#_查看可用的gitlab软件包">3.1.3. 查看可用的GitLab软件包</a></li>
<li><a href="#_默认禁用gitlab仓库">3.1.4. 默认禁用GitLab仓库</a></li>
</ul>
</li>
<li><a href="#_安装gitlab软件包">3.2. 安装GitLab软件包</a>
<ul class="sectlevel3">
<li><a href="#_安装gitlab依赖">3.2.1. 安装GitLab依赖</a></li>
<li><a href="#_预设gitlab运行参数">3.2.2. 预设GitLab运行参数</a></li>
<li><a href="#_手动安装gitlab">3.2.3. 手动安装GitLab</a></li>
</ul>
</li>
<li><a href="#_查看gitlab服务状态">3.3. 查看GitLab服务状态</a>
<ul class="sectlevel3">
<li><a href="#_查看gitlab的系统服务状态">3.3.1. 查看GitLab的系统服务状态</a></li>
<li><a href="#_查看gitlab的所有组件状态">3.3.2. 查看GitLab的所有组件状态</a></li>
<li><a href="#_查看gitlab默认http端口">3.3.3. 查看GitLab默认HTTP端口</a></li>
</ul>
</li>
<li><a href="#_为gitlab新增防火墙规则">3.4. 为GitLab新增防火墙规则</a></li>
</ul>
</li>
<li><a href="#_jenkins">4. Jenkins</a>
<ul class="sectlevel2">
<li><a href="#_新增jenkins_yum仓库">4.1. 新增Jenkins Yum仓库</a>
<ul class="sectlevel3">
<li><a href="#_下载仓库文件">4.1.1. 下载仓库文件</a></li>
<li><a href="#_导入仓库密钥">4.1.2. 导入仓库密钥</a></li>
<li><a href="#_默认禁用jenkins仓库">4.1.3. 默认禁用Jenkins仓库</a></li>
</ul>
</li>
<li><a href="#_安装jenkins软件包">4.2. 安装Jenkins软件包</a>
<ul class="sectlevel3">
<li><a href="#_安装依赖">4.2.1. 安装依赖</a></li>
<li><a href="#_安装jenkins">4.2.2. 安装Jenkins</a></li>
</ul>
</li>
<li><a href="#_配置jenkins服务">4.3. 配置Jenkins服务</a>
<ul class="sectlevel3">
<li><a href="#_开机启动jenkins">4.3.1. 开机启动Jenkins</a></li>
</ul>
</li>
<li><a href="#_为jenkins新增防火墙规则">4.4. 为Jenkins新增防火墙规则</a></li>
<li><a href="#_访问jenkins">4.5. 访问jenkins</a></li>
</ul>
</li>
<li><a href="#_ssh">5. ssh</a>
<ul class="sectlevel2">
<li><a href="#_无密码登录">5.1. 无密码登录</a></li>
<li><a href="#_ssh密钥对克隆git仓库">5.2. ssh密钥对克隆git仓库</a></li>
<li><a href="#_cmd无法识别ssh">5.3. cmd无法识别ssh</a></li>
</ul>
</li>
<li><a href="#_prometheus">6. prometheus</a>
<ul class="sectlevel2">
<li><a href="#_prometheus_2">6.1. Prometheus</a></li>
<li><a href="#_prometheus_systemctl">6.2. prometheus-systemctl</a></li>
<li><a href="#NODE_EXPORTER">6.3. node_exporter</a></li>
<li><a href="#_node_exporter_systemctl">6.4. node_exporter-systemctl</a></li>
<li><a href="#_prometheus获取node_exporter数据">6.5. Prometheus获取node_exporter数据</a></li>
<li><a href="#_prometheussql">6.6. prometheusSql</a></li>
<li><a href="#_安装mysql_exporter">6.7. 安装mysql exporter</a></li>
</ul>
</li>
<li><a href="#_zabbix">7. Zabbix</a>
<ul class="sectlevel2">
<li><a href="#_选择zabbix服务器的平台">7.1. 选择Zabbix服务器的平台</a></li>
<li><a href="#_安装配置zabbix">7.2. 安装配置zabbix</a></li>
<li><a href="#_快速开始">7.3. 快速开始</a></li>
<li><a href="#_zabbixmysql">7.4. Zabbix+Mysql</a>
<ul class="sectlevel3">
<li><a href="#_overview">7.4.1. Overview</a></li>
<li><a href="#_requirements">7.4.2. Requirements</a></li>
<li><a href="#_tested_versions">7.4.3. Tested versions</a></li>
<li><a href="#_setup">7.4.4. Setup</a></li>
<li><a href="#_start">7.4.5. Start</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_zhiyan_mod_letsencrypt">8. zhiyan-mod-letsencrypt</a>
<ul class="sectlevel2">
<li><a href="#_配置zhiyan_mod_letsencrypt">8.1. 配置zhiyan-mod-letsencrypt</a></li>
<li><a href="#_安装zysdk">8.2. 安装zySDK</a></li>
</ul>
</li>
<li><a href="#_zhiyan_mod_php_fpm">9. zhiyan-mod-php-fpm</a>
<ul class="sectlevel2">
<li><a href="#_克隆_zhiyan_mod_php_fpmlibzygrpclibzymod_rust">9.1. 克隆 zhiyan-mod-php-fpm、libzygrpc、libzymod-rust</a>
<ul class="sectlevel3">
<li><a href="#_配置zhiyan_mod_php_fpm">9.1.1. 配置zhiyan-mod-php-fpm</a></li>
</ul>
</li>
<li><a href="#_rust">9.2. RUST</a></li>
<li><a href="#_编译zhiyan_mod_php_fpm并运行">9.3. 编译zhiyan-mod-php-fpm并运行</a></li>
</ul>
</li>
<li><a href="#_grpcpython">10. grpc+python</a>
<ul class="sectlevel2">
<li><a href="#_快速开始_2">10.1. 快速开始</a>
<ul class="sectlevel3">
<li><a href="#_环境准备">10.1.1. 环境准备</a></li>
<li><a href="#_安装grpc">10.1.2. 安装gRPC</a></li>
<li><a href="#_grpc_tools">10.1.3. gRPC tools</a></li>
<li><a href="#_下载example">10.1.4. 下载example</a></li>
<li><a href="#_运行_grpc_应用">10.1.5. 运行 gRPC 应用</a></li>
<li><a href="#_更新grpc_service">10.1.6. 更新gRPC service</a></li>
<li><a href="#_生成grpc代码">10.1.7. 生成gRPC代码</a></li>
<li><a href="#_更新并运行该应用">10.1.8. 更新并运行该应用</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_zhiyan_mod_iptables">11. zhiyan-mod-iptables</a>
<ul class="sectlevel2">
<li><a href="#_zhiyan_mod_iptables_2">11.1. zhiyan-mod-iptables</a></li>
</ul>
</li>
<li><a href="#_zhiyan">12. zhiyan</a>
<ul class="sectlevel2">
<li><a href="#_zhiyan_web_flutter">12.1. zhiyan-web-flutter</a></li>
<li><a href="#_zhiyan_web_server">12.2. zhiyan-web-server</a></li>
<li><a href="#_cargo_toml">12.3. Cargo.toml</a></li>
<li><a href="#_zhiyan_agent">12.4. zhiyan-agent</a></li>
<li><a href="#_zhian_server">12.5. zhian-server</a></li>
</ul>
</li>
<li><a href="#_zhiyan_mod">13. zhiyan-mod</a>
<ul class="sectlevel2">
<li><a href="#_zhiyan_mod_cpu">13.1. zhiyan-mod-cpu</a></li>
</ul>
</li>
<li><a href="#_python">14. Python</a>
<ul class="sectlevel2">
<li><a href="#_centos9_install_python311">14.1. CentOS9 Install Python311</a>
<ul class="sectlevel3">
<li><a href="#_编译安装">14.1.1. 编译安装</a></li>
</ul>
</li>
<li><a href="#_python版本管理">14.2. Python版本管理</a></li>
</ul>
</li>
<li><a href="#_Terminal_chapter">15. Terminal</a>
<ul class="sectlevel2">
<li><a href="#_zsr">15.1. zsr</a></li>
</ul>
</li>
<li><a href="#_mqtt">16. MQTT</a>
<ul class="sectlevel2">
<li><a href="#_mqttdemo">16.1. MQTTdemo</a></li>
</ul>
</li>
<li><a href="#_troubleshoot">17. troubleshoot</a>
<ul class="sectlevel2">
<li><a href="#_troubleshoot_2">17.1. troubleshoot</a></li>
</ul>
</li>
<li><a href="#_mysql主从">18. mysql主从</a></li>
<li><a href="#_pypi">19. pypi</a>
<ul class="sectlevel2">
<li><a href="#_打包成可执行文件">19.1. 打包成可执行文件</a></li>
<li><a href="#_上传到pypi">19.2. 上传到pypi</a></li>
</ul>
</li>
<li><a href="#_kafka">20. kafka</a>
<ul class="sectlevel2">
<li><a href="#_quickstart">20.1. quickstart</a>
<ul class="sectlevel3">
<li><a href="#_环境准备_2">20.1.1. 环境准备</a></li>
<li><a href="#_1_下载kafka">20.1.2. 1.下载KAFKA</a></li>
<li><a href="#_2_启动kafka环境">20.1.3. 2.启动KAFKA环境</a></li>
<li><a href="#_3_创建一个topic用来存储事件">20.1.4. 3.创建一个topic用来存储事件</a></li>
<li><a href="#_4_往该topic中写入事件">20.1.5. 4.往该topic中写入事件</a></li>
<li><a href="#_5_读事件">20.1.6. 5.读事件</a></li>
<li><a href="#_6_用kafka_connnect将数据导入导出成事件流">20.1.7. 6.用KAFKA CONNNECT将数据导入/导出成事件流</a></li>
<li><a href="#_常用命令">20.1.8. 常用命令</a></li>
</ul>
</li>
<li><a href="#_kafka_java_demo">20.2. kafka java demo</a></li>
</ul>
</li>
<li><a href="#_rabbitmq">21. RabbitMQ</a>
<ul class="sectlevel2">
<li><a href="#_rabbitmq安装">21.1. RabbitMQ安装</a></li>
<li><a href="#_rabbitmq_配置">21.2. RabbitMQ 配置</a></li>
<li><a href="#_rabbimq使用">21.3. RabbiMQ使用</a>
<ul class="sectlevel3">
<li><a href="#_rabbitmq_cli">21.3.1. RabbitMQ cli</a></li>
<li><a href="#_python_2">21.3.2. python</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_yum换源">22. yum换源</a>
<ul class="sectlevel2">
<li><a href="#_yum_换源">22.1. yum 换源</a></li>
<li><a href="#_yum常用命令">22.2. yum常用命令</a></li>
</ul>
</li>
<li><a href="#_proxychains">23. Proxychains</a>
<ul class="sectlevel2">
<li><a href="#_安装配置">23.1. 安装配置</a></li>
</ul>
</li>
<li><a href="#_drupal环境搭建">24. Drupal环境搭建</a>
<ul class="sectlevel2">
<li><a href="#Nginx_install_chapter">24.1. 配置内网环境一：安装Nginx</a></li>
<li><a href="#PHP_install_chapter">24.2. 配置内网环境二：安装PHP</a></li>
<li><a href="#_配置内网环境三lnmp环境测试">24.3. 配置内网环境三：LNMP环境测试</a></li>
</ul>
</li>
<li><a href="#_hadoop">25. hadoop</a>
<ul class="sectlevel2">
<li><a href="#_环境准备_3">25.1. 环境准备</a></li>
<li><a href="#_hadoop安装配置">25.2. hadoop安装配置</a></li>
<li><a href="#_集群操作">25.3. 集群操作</a></li>
</ul>
</li>
<li><a href="#_wordpress">26. WordPress</a>
<ul class="sectlevel2">
<li><a href="#_配置内网环境一安装nginx">26.1. 配置内网环境一：安装Nginx</a></li>
<li><a href="#_配置内网环境二安装php">26.2. 配置内网环境二：安装PHP</a></li>
<li><a href="#mariadb_install_chapter">26.3. 配置内网环境三：安装mariadb</a></li>
<li><a href="#_配置内网环境四安装wordpress">26.4. 配置内网环境四：安装WordPress</a></li>
</ul>
</li>
<li><a href="#_elasticsearch">27. ElasticSearch</a>
<ul class="sectlevel2">
<li><a href="#ElasticSearch_install_chapter">27.1. ElasticSearch安装</a></li>
<li><a href="#_kibana安装">27.2. Kibana安装</a></li>
<li><a href="#_filebeat安装">27.3. filebeat安装</a></li>
</ul>
</li>
<li><a href="#_minikube">28. minikube</a>
<ul class="sectlevel2">
<li><a href="#_minikube安装">28.1. minikube安装</a></li>
<li><a href="#_k8s">28.2. k8s</a>
<ul class="sectlevel3">
<li><a href="#_常用命令_2">28.2.1. 常用命令</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_docker">29. Docker</a>
<ul class="sectlevel2">
<li><a href="#_docker安装">29.1. Docker安装</a></li>
<li><a href="#_常用命令_3">29.2. 常用命令</a></li>
</ul>
</li>
<li><a href="#_nginx">30. Nginx</a>
<ul class="sectlevel2">
<li><a href="#_proxy_pass">30.1. proxy_pass</a></li>
<li><a href="#_try_files">30.2. try_files</a></li>
<li><a href="#_rewrite">30.3. rewrite</a></li>
<li><a href="#_return">30.4. return</a></li>
</ul>
</li>
<li><a href="#_java">31. java</a>
<ul class="sectlevel2">
<li><a href="#_java安装">31.1. java安装</a>
<ul class="sectlevel3">
<li><a href="#_linuxcentos_stream9">31.1.1. linux(centos-stream9)</a></li>
<li><a href="#_windows10">31.1.2. windows10</a></li>
</ul>
</li>
<li><a href="#_java环境切换">31.2. java环境切换</a></li>
<li><a href="#_gradle换源">31.3. gradle换源</a></li>
<li><a href="#_maven换源">31.4. maven换源</a>
<ul class="sectlevel3">
<li><a href="#_方法一">31.4.1. 方法一：</a></li>
<li><a href="#_方法二">31.4.2. 方法二：</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_kvm">32. kvm</a>
<ul class="sectlevel2">
<li><a href="#_kvm虚拟机使用usb">32.1. kvm虚拟机使用usb</a></li>
</ul>
</li>
<li><a href="#_开机自动执行脚本">33. 开机自动执行脚本</a>
<ul class="sectlevel2">
<li><a href="#_方法一修改_etcrc_drc_local_文件">33.1. 方法一：修改 /etc/rc.d/rc.local 文件</a></li>
<li><a href="#_方法二使用_crontab">33.2. 方法二：使用 crontab</a></li>
</ul>
</li>
<li><a href="#_frp_chapter">34. ftp</a>
<ul class="sectlevel2">
<li><a href="#_ftp站点搭建">34.1. FTP站点搭建</a>
<ul class="sectlevel3">
<li><a href="#_步骤一安装vsftpd">34.1.1. 步骤一：安装vsftpd</a></li>
<li><a href="#_步骤二配置vsftpd">34.1.2. 步骤二：配置vsftpd</a></li>
<li><a href="#_步骤三新增防火墙规则">34.1.3. 步骤三：新增防火墙规则</a></li>
<li><a href="#_步骤四客户端测试">34.1.4. 步骤四：客户端测试</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_gost">35. gost</a>
<ul class="sectlevel2">
<li><a href="#_国外服务器">35.1. 国外服务器</a></li>
<li><a href="#_落地客户端">35.2. 落地客户端</a></li>
</ul>
</li>
<li><a href="#_Misc_chapter">36. 杂项</a>
<ul class="sectlevel2">
<li><a href="#_chrome">36.1. Chrome</a>
<ul class="sectlevel3">
<li><a href="#_安装_proxy_switchyomega_扩展">36.1.1. 安装 Proxy SwitchyOmega 扩展</a></li>
<li><a href="#_switchyomega实现自动代理切换">36.1.2. SwitchyOmega实现自动代理切换</a></li>
</ul>
</li>
<li><a href="#_辨别虚拟机物理机">36.2. 辨别虚拟机物理机</a>
<ul class="sectlevel3">
<li><a href="#_linux">36.2.1. linux</a></li>
<li><a href="#_windows">36.2.2. windows</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_Docker_chapter">1. Ceph</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>基于 Centos-stream-9</strong></p>
</div>
<div class="sect2">
<h3 id="_搭建ceph_cluster">1.1. 搭建Ceph Cluster</h3>
<div class="paragraph">
<p>Ceph Cluster包含三个虚拟机：ceph1 ceph2 ceph3</p>
</div>
<div class="paragraph">
<p>ceph1 ceph2 ceph3上进行以下操作</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dnf install -y epel-release
dnf install -y systemd-timesyncd
systemctl enable systemd-timesyncd --now
rpm -Uvh https://download.ceph.com/rpm-18.1.3/el9/noarch/ceph-release-1-1.el9.noarch.rpm
dnf install -y cephadm podman
dnf install -y centos-release-ceph-pacific</code></pre>
</div>
</div>
<div class="paragraph">
<p>ceph1进行以下操作</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cephadm bootstrap --mon-ip 192.168.122.60</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
终端输出如下内容,注意保存Password
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">https://192.168.122.60:8443/
User: admin
Password: 65eoa3cblm</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后继续执行如下命令</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cephadm shell
cephadm add-repo --release quincy
dnf install ceph-common</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果已经对下载cephadm的路径换了源，可使用</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cephadm install ceph-common</code></pre>
</div>
</div>
<div class="paragraph">
<p>安装ceph-common</p>
</div>
<div class="paragraph">
<p>修改下载cephadm的路径</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim  /etc/yum.repos.d/ceph.repo</code></pre>
</div>
</div>
<div class="paragraph">
<p>参考
<a href="https://docs.ceph.com/en/latest/install/mirrors/" class="bare">https://docs.ceph.com/en/latest/install/mirrors/</a></p>
</div>
<div class="paragraph">
<p>CN: China: <a href="http://mirrors.ustc.edu.cn/ceph/" class="bare">http://mirrors.ustc.edu.cn/ceph/</a></p>
</div>
<div class="paragraph">
<p>查看ceph版本号和状态</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph -v
ceph status</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置ceph1能无密码登陆ceph1 ceph2 ceph3</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph cephadm get-pub-key &gt; ~/ceph.pub
ssh-copy-id -f -i ~/ceph.pub root@ceph1
ssh-copy-id -f -i ~/ceph.pub root@ceph2
ssh-copy-id -f -i ~/ceph.pub root@ceph3</code></pre>
</div>
</div>
<div class="paragraph">
<p>添加ceph1 ceph2 ceph3到cluster</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cephadm shell -- ceph orch host add ceph1 192.168.122.60
cephadm shell -- ceph orch host add ceph2 192.168.122.61
cephadm shell -- ceph orch host add ceph3 192.168.122.62</code></pre>
</div>
</div>
<div class="paragraph">
<p>给ceph1 ceph2 ceph3打label</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cephadm shell -- ceph orch host label add ceph1 mon
cephadm shell -- ceph orch host label add ceph2 mon
cephadm shell -- ceph orch host label add ceph3 mon</code></pre>
</div>
</div>
<div class="paragraph">
<p>添加osd</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cephadm shell -- ceph orch daemon add osd ceph1:/dev/vdb
cephadm shell -- ceph orch daemon add osd ceph2:/dev/vdb
cephadm shell -- ceph orch daemon add osd ceph3:/dev/vdb</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_部署cephfs">1.2. 部署CephFS</h3>
<div class="paragraph">
<p>参照官网链接
<a href="https://docs.ceph.com/en/latest/cephadm/services/mds/#orchestrator-cli-cephfs" class="bare">https://docs.ceph.com/en/latest/cephadm/services/mds/#orchestrator-cli-cephfs</a>
在ceph1上执行以下命令</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph fs volume create geek_cephfs  --placement=3
ceph fs ls
ceph fs volume info geek_cephfs
ceph mds stat
ceph orch apply mds geek_cephfs --placement=3</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@ceph1 ~]#

  cluster:
    id:     de382350-3221-11ee-bc03-525400b83c9a
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum stream960,stream961,stream962 (age 9m)
    mgr: stream960.vperxy(active, since 52m), standbys: stream961.ldsnmd
    mds: 1/1 daemons up, 2 standby
    osd: 3 osds: 3 up (since 8m), 3 in (since 9m)

  data:
    volumes: 1/1 healthy
    pools:   3 pools, 49 pgs
    objects: 24 objects, 451 KiB
    usage:   81 MiB used, 90 GiB / 90 GiB avail
    pgs:     49 active+clean</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
使用cat /etc/ceph/ceph.client.admin.keyring查看key，用于挂载cephFS
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre># [root@stream960 ~]# cat /etc/cat /etc/ceph/ceph.client.admin.keyringceph/ceph.client.admin.keyring
# [client.admin]
# 	key = AQCZ4ctks3nnHxAAgGpIFheYkpdCoBERg98x3g==
# 	caps mds = "allow *"
# 	caps mgr = "allow *"
# 	caps mon = "allow *"
# 	caps osd = "allow *"</pre>
</div>
</div>
<div class="paragraph">
<p>在任何主机上执行以下命令</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /mnt/ceph
mount -t ceph 192.168.122.60:6789,192.168.122.61:6789,192.168.122.62:6789:/ /mnt/ceph -o name=admin,secret=AQCZ4ctks3nnHxAAgGpIFheYkpdCoBERg98x3g==</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_部署cephrwg">1.3. 部署CephRWG</h3>
<div class="paragraph">
<p>安装ceph-radosgw</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo yum install -y ceph-radosgw</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_打标签">1.3.1. 打标签</h4>
<div class="paragraph">
<p>主要作用是根据标签决定rgw运行在那些机器上</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph orch host label add ceph1 rgw
ceph orch host label add ceph2 rgw
ceph orch host label add ceph3 rgw</code></pre>
</div>
</div>
<div class="paragraph">
<p>启动rgw</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ceph orch apply rgw test_rgw default --placement=label:rgw --port=8000</code></pre>
</div>
</div>
<div class="paragraph">
<p>curl测试连接rgw服务
查看域信息</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">radosgw-admin zone get --rgw-zone=default
连接
[source, bash]
curl http://ceph1:8000</code></pre>
</div>
</div>
<div class="paragraph">
<p>安装s3cmd</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">apt install -y ceph-common s3cmd</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建用户
[Note]注意保存access_key和secret_key值</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">radosgw-admin user create --uid=xy --display-name=administrator --email=xy@xy.com</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用s3">1.3.2. 使用S3</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">s3cmd --configure
# 输入access_key
KUJSQNRB5QCGGOHMB6I0
# 输入secret_key
ai4zduUFCjC83JJ4E6GqaWHFHCmsOp14qptCfZaE
# 输入域()
default
# 输入rgw访问接口
storage02:8000
# 连接存储桶域名
storage02
# 输入密码，没有加密。回车
回车
# 有没有gpg目录，安装s3服务就会有
回车
# 是否用https
No
# 是否有代理
回车
# 测试连通性，返回success代表成功
y
# 是否保存
y</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建存储桶测试</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">s3cmd mb s3://bucket1
查看存储桶
[source, bash]
s3cmd ls</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用swift">1.3.3. 使用swift</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install python-swiftclient
创建用户
[source, bash]
radosgw-admin user create --uid="testuser" --display-name="First User"</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建子用户</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">radosgw-admin subuser create --uid=testuser --subuser=testuser:swift --access=full</code></pre>
</div>
</div>
<div class="paragraph">
<p>swift常用命令</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">swift -A http://192.168.122.106:8000/auth/1.0 -U czhswift:swift -K AquvhRPHOom3S5dWLjyJYZwOwYKUz11EiSikZqgG post swiftbucket
swift -A http://192.168.122.106:8000/auth/1.0 -U czhswift:swift -K AquvhRPHOom3S5dWLjyJYZwOwYKUz11EiSikZqgG delete swiftbucket
swift -A http://192.168.122.106:8000/auth/1.0 -U czhswift:swift -K AquvhRPHOom3S5dWLjyJYZwOwYKUz11EiSikZqgG list
swift -A http://192.168.122.106:8000/auth/1.0 -U czhswift:swift -K AquvhRPHOom3S5dWLjyJYZwOwYKUz11EiSikZqgG list swiftbucket
swift -A http://192.168.122.106:8000/auth/1.0 -U czhswift:swift -K AquvhRPHOom3S5dWLjyJYZwOwYKUz11EiSikZqgG stat
swift -A http://192.168.122.106:8000/auth/1.0 -U czhswift:swift -K AquvhRPHOom3S5dWLjyJYZwOwYKUz11EiSikZqgG upload swiftbucket 1.txt
swift -A http://192.168.122.106:8000/auth/1.0 -U czhswift:swift -K AquvhRPHOom3S5dWLjyJYZwOwYKUz11EiSikZqgG delete swiftbucket 1.txt</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_git">2. Git</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_在服务器上搭建git">2.1. 在服务器上搭建Git</h3>
<div class="paragraph">
<p>在开始架设 Git 服务器前，需要把现有仓库导出为裸仓库——即一个不包含当前工作目录的仓库。 这通常是很简单的。 为了通过克隆你的仓库来创建一个新的裸仓库，你需要在克隆命令后加上 --bare 选项。 按照惯例，裸仓库的目录名以 .git 结尾，就像这样：
通常有两种办法：</p>
</div>
<div class="paragraph">
<p>从已有仓库克隆，或者创建dir,初始化为空仓库</p>
</div>
<div class="sect3">
<h4 id="_从已有仓库克隆">2.1.1. 从已有仓库克隆</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git clone --bare my_project my_project.git
Cloning into bare repository 'my_project.git'...
done.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_创建dir初始化为空仓库">2.1.2. 创建dir,初始化为空仓库</h4>
<div class="paragraph">
<p>在某一个路径下，创建一个目录</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir my_project.git
进入该目录
[source, bash]
cd my_project.git
初始化这个目录，使其成为一个空仓库
[source, bash]
git init --bare --shared</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_用户clonepush">2.1.3. 用户clone/push</h4>
<div class="paragraph">
<p>on John&#8217;s computer</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cd myproject
$ git init
$ git add .
$ git commit -m 'initial commit'
$ git remote add origin git@gitserver:/srv/git/project.git
$ git push origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>此时，其他开发者可以克隆此仓库，并推回各自的改动，步骤很简单：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ git clone git@gitserver:/srv/git/project.git
$ cd project
$ vim README
$ git commit -am 'fix for the README file'
$ git push origin master</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gitlab">3. GitLab</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_新增gitlab_yum仓库">3.1. 新增GitLab Yum仓库</h3>
<div class="sect3">
<h4 id="_添加yum仓库">3.1.1. 添加Yum仓库</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | bash</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_列出gitlab的仓库列表">3.1.2. 列出GitLab的仓库列表</h4>
<div class="paragraph">
<p>执行一下命令</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum repolist all | grep gitlab</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>gitlab_gitlab-ce/x86_64             gitlab_gitlab-ce        enabled:         853
!gitlab_gitlab-ce-source            gitlab_gitlab-ce-source disabled</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查看可用的gitlab软件包">3.1.3. 查看可用的GitLab软件包</h4>
<div class="paragraph">
<p>列出软件包列表</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum repo-pkgs gitlab_gitlab-ce list</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.bfsu.edu.cn
 * extras: mirrors.bfsu.edu.cn
 * updates: mirrors.cqu.edu.cn
Available Packages
gitlab-ce.x86_64                                 15.7.3-ce.0.el7                                 gitlab_gitlab-ce</pre>
</div>
</div>
<div class="paragraph">
<p>查看软件包描述</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum --disablerepo=\* --enablerepo=gitlab_gitlab-ce info gitlab-ce</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.bfsu.edu.cn
 * extras: mirrors.bfsu.edu.cn
 * updates: mirrors.cqu.edu.cn
Available Packages
Name        : gitlab-ce
Arch        : x86_64
Version     : 15.7.3
Release     : ce.0.el7
Size        : 1.1 G
Repo        : gitlab_gitlab-ce/x86_64
Summary     : GitLab Community Edition (including NGINX, Postgres, Redis)
URL         : https://about.gitlab.com/
License     : MIT
Description : GitLab Community Edition (including NGINX, Postgres, Redis)</pre>
</div>
</div>
<div class="paragraph">
<p>GitLab的软件包比较大，安装过程时间较长</p>
</div>
</div>
<div class="sect3">
<h4 id="_默认禁用gitlab仓库">3.1.4. 默认禁用GitLab仓库</h4>
<div class="paragraph">
<p>按需单独启用GitLab仓库
GitLab仓库（服务器位于国外）经常无法访问或者速度慢，影响Yum使用，默认禁用之</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum-config-manager --disable gitlab_gitlab-ce | egrep '(\[gitlab_gitlab-ce\])|enabled'</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#[gitlab_gitlab-ce]

#enabled = 0 或 False</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_安装gitlab软件包">3.2. 安装GitLab软件包</h3>
<div class="sect3">
<h4 id="_安装gitlab依赖">3.2.1. 安装GitLab依赖</h4>
<div class="paragraph">
<p>运行 gitlab-ctl 命令时，会出现警告：</p>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ffi-libarchive could not be loaded, libarchive is probably not installed on system, archive_file will not be available</pre>
</div>
</div>
<div class="paragraph">
<p>安装 libarchive 包，消除警告：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y libarchive</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_预设gitlab运行参数">3.2.2. 预设GitLab运行参数</h4>
<div class="paragraph">
<p>预设GitLab访问URL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">EXTERNAL_URL="http://gitlab.sjx.com:8181"</code></pre>
</div>
</div>
<div class="paragraph">
<p>预设GitLab默认密码</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">GITLAB_ROOT_PASSWORD=$(pwgen -s 20|head -n 1)
echo -e "GitLab默认用户：root\nGitLab默认密码：${GITLAB_ROOT_PASSWORD}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GitLab默认用户：root
GitLab默认密码：QJQCM3fAFXKYpYUeSL5e</pre>
</div>
</div>
<div class="paragraph">
<p>预设GitLab访问域名</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">egrep '^127.0.0.1 gitlab.sjx.com$' /etc/hosts &gt; /dev/null || echo '127.0.0.1 gitlab.sjx.com' &gt;&gt; /etc/hosts</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>127.0.0.1 gitlab.sjx.com 只为安装，无其它实质作用
域名 gitlab.sjx.com 必须能解析出IP地址，EXTERNAL_URL参数才有效
这样安装后，不再需要手动修改 /etc/gitlab/gitlab.rb 文件中的 external_url 参数</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_手动安装gitlab">3.2.3. 手动安装GitLab</h4>
<div class="paragraph">
<p>打印GitLab软件包URL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">GITLAB_RPM_URL=$(yumdownloader --disablerepo=\* --enablerepo=gitlab_gitlab-ce --urls gitlab-ce | egrep '^https://.+\.rpm$')
GITLAB_RPM_FILE=/tmp/$(basename ${GITLAB_RPM_URL})

echo -e "GitLab软件包文件：\n\t${GITLAB_RPM_FILE}\n GitLab软件包URL：\n\t${GITLAB_RPM_URL}"</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>GitLab软件包文件：
	/tmp/gitlab-ce-15.7.3-ce.0.el7.x86_64.rpm
 GitLab软件包URL：
	https://packages.gitlab.com/gitlab/gitlab-ce/el/7/x86_64/gitlab-ce-15.7.3-ce.0.el7.x86_64.rpm</pre>
</div>
</div>
<div class="paragraph">
<p>下载软件包</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">wget -c ${GITLAB_RPM_URL} -O ${GITLAB_RPM_FILE}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
wget 因为带了 -c 参数，下载速度慢时，可以中断下载，多次重新运行上面的命令
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>安装GitLab</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">EXTERNAL_URL=${EXTERNAL_URL} GITLAB_ROOT_PASSWORD=${GITLAB_ROOT_PASSWORD} yum install -y ${GITLAB_RPM_FILE}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
GitLab安装成功后，请手动删除下载的文件：rm -f /tmp/gitlab-ce*.rpm
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>（安装时，终端输出类似 网络安装GitLab）</p>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Loaded plugins: fastestmirror
Examining /tmp/gitlab-ce-15.6.3-ce.0.el7.x86_64.rpm: gitlab-ce-15.6.3-ce.0.el7.x86_64
Marking /tmp/gitlab-ce-15.6.3-ce.0.el7.x86_64.rpm to be installed
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package gitlab-ce.x86_64 0:15.6.3-ce.0.el7 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

==============================================================================================
 Package        Arch        Version              Repository                               Size
==============================================================================================
Installing:
 gitlab-ce      x86_64      15.6.3-ce.0.el7      /gitlab-ce-15.6.3-ce.0.el7.x86_64      2.4 G

Transaction Summary
==============================================================================================
Install  1 Package

Total size: 2.4 G
Installed size: 2.4 G
...内容同上...
...内容同上...
...内容同上...</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_查看gitlab服务状态">3.3. 查看GitLab服务状态</h3>
<div class="sect3">
<h4 id="_查看gitlab的系统服务状态">3.3.1. 查看GitLab的系统服务状态</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl status gitlab-runsvdir</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>● gitlab-runsvdir.service - GitLab Runit supervision process
   Loaded: loaded (/usr/lib/systemd/system/gitlab-runsvdir.service; enabled; vendor preset: disabled)
   Active: active (running) since Sat 2023-01-14 00:30:42 CST; 11h ago
 Main PID: 10912 (runsvdir)
   CGroup: /system.slice/gitlab-runsvdir.service
           ├─10912 runsvdir -P /opt/gitlab/service log: .............................................
           ├─10914 runsv logrotate
           ├─10924 svlogd -tt /var/log/gitlab/logrotate
           ├─10930 runsv redis
           ├─10932 /opt/gitlab/embedded/bin/redis-server unixsocket:/var/opt/gitlab/redis/redis.socket
           ├─10940 svlogd -tt /var/log/gitlab/redis
           ├─10950 runsv gitaly
           ├─10975 svlogd /var/log/gitlab/gitaly
           ├─11079 runsv postgresql
...省略的内容...
...省略的内容...
...省略的内容...
Jan 14 00:30:42 lan_server systemd[1]: Started GitLab Runit supervision process.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查看gitlab的所有组件状态">3.3.2. 查看GitLab的所有组件状态</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">gitlab-ctl status</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>run: alertmanager: (pid 11869) 39866s; run: log: (pid 11659) 39907s
run: gitaly: (pid 11728) 39876s; run: log: (pid 10975) 40076s
run: gitlab-exporter: (pid 11845) 39868s; run: log: (pid 11451) 39925s
run: gitlab-kas: (pid 11817) 39870s; run: log: (pid 11225) 40017s
run: gitlab-workhorse: (pid 11829) 39869s; run: log: (pid 11371) 39942s
run: logrotate: (pid 25010) 488s; run: log: (pid 10924) 40088s
run: nginx: (pid 11399) 39940s; run: log: (pid 11415) 39938s
run: node-exporter: (pid 11839) 39869s; run: log: (pid 11443) 39931s
run: postgres-exporter: (pid 11879) 39866s; run: log: (pid 11682) 39903s
run: postgresql: (pid 11081) 40037s; run: log: (pid 11125) 40034s
run: prometheus: (pid 11854) 39867s; run: log: (pid 11630) 39914s
run: puma: (pid 11287) 39958s; run: log: (pid 11294) 39957s
run: redis: (pid 10932) 40084s; run: log: (pid 10940) 40082s
run: redis-exporter: (pid 11847) 39868s; run: log: (pid 11469) 39919s
run: sidekiq: (pid 11303) 39952s; run: log: (pid 11320) 39950s</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_查看gitlab默认http端口">3.3.3. 查看GitLab默认HTTP端口</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">gitlab-ctl show-config 2&gt;/dev/null | grep '"external-url":'</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    "external-url": "http://gitlab.sjx.com:8181",</pre>
</div>
</div>
<div class="paragraph">
<p>GitLab访问URL：http://gitlab.sjx.com:8181</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_为gitlab新增防火墙规则">3.4. 为GitLab新增防火墙规则</h3>
<div class="paragraph">
<p>1.增加防火墙放行规则</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">GITLAB_PORT=8181
PERM="--permanent"
SERV_NAME=GITLAB_${GITLAB_PORT}
SERV="${PERM} --service=${SERV_NAME}"

firewall-cmd ${PERM} --new-service=${SERV_NAME}
firewall-cmd ${SERV} --set-short="GitLab ports"
firewall-cmd ${SERV} --set-description="GitLab port exceptions"
firewall-cmd ${SERV} --add-port=${GITLAB_PORT}/tcp
firewall-cmd ${PERM} --add-service=${SERV_NAME}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">参数说明</div>
<p>GITLAB_PORT
GITLAB运行端口注意和 预设GitLab访问URL 的端口保持一致</p>
</div>
<div class="paragraph">
<p>2.重载防火墙配置</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">firewall-cmd --reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.查看防火墙规则</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">firewall-cmd --list-all</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3
  sources:
  services: GITLAB_8181 dhcpv6-client ssh
  ports:
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:</pre>
</div>
</div>
<div class="paragraph">
<p>放行的规则中必须有 GITLAB_8181 服务
现在，可以去试一试 第一次访问GitLab Web
访问 <a href="http://gitlab.sjx.com:8181" class="bare">http://gitlab.sjx.com:8181</a> ，完成第一次登录操作</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jenkins">4. Jenkins</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.jenkins.io/doc/book/installing/linux/#red-hat-centos">jenkins官网安装步骤</a></p>
</div>
<div class="sect2">
<h3 id="_新增jenkins_yum仓库">4.1. 新增Jenkins Yum仓库</h3>
<div class="sect3">
<h4 id="_下载仓库文件">4.1.1. 下载仓库文件</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo wget --inet4-only \
    -O /etc/yum.repos.d/jenkins.repo \
    https://pkg.jenkins.io/redhat-stable/jenkins.repo</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
wget参数说明
--inet4-only
表示仅使用IPv4下载文件。pkg.jenkins.io 使用了IPv6解析域名，可能导致下载失败
-O
下载文件保存到指定位置
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_导入仓库密钥">4.1.2. 导入仓库密钥</h4>
<div class="paragraph">
<p>导入密钥</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key</code></pre>
</div>
</div>
<div class="paragraph">
<p>更新缓存</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo yum upgrade</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_默认禁用jenkins仓库">4.1.3. 默认禁用Jenkins仓库</h4>
<div class="paragraph">
<p>按需单独启用Jenkins仓库</p>
</div>
<div class="paragraph">
<p>Jenkins仓库（服务器位于国外）经常无法访问或者速度慢，影响Yum使用，默认禁用之</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum-config-manager --disable jenkins | egrep '(\[jenkins\])|enabled'</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[jenkins]
enabled = 0 或 False</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_安装jenkins软件包">4.2. 安装Jenkins软件包</h3>
<div class="sect3">
<h4 id="_安装依赖">4.2.1. 安装依赖</h4>
<div class="paragraph">
<p>1.安装Java11</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo yum install fontconfig java-17-openjdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.查看默认Java版本</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">java -version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>openjdk version "17.0.6" 2023-01-17 LTS
OpenJDK Runtime Environment (Red_Hat-17.0.6.0.10-3.el9) (build 17.0.6+10-LTS)
OpenJDK 64-Bit Server VM (Red_Hat-17.0.6.0.10-3.el9) (build 17.0.6+10-LTS, mixed mode, sharing)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_安装jenkins">4.2.2. 安装Jenkins</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum --disablerepo=\* --enablerepo=jenkins install -y jenkins</code></pre>
</div>
</div>
<div class="paragraph">
<p>重新加载系统管理守护进程 (systemd) 的配置文件</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo systemctl daemon-reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_配置jenkins服务">4.3. 配置Jenkins服务</h3>
<div class="sect3">
<h4 id="_开机启动jenkins">4.3.1. 开机启动Jenkins</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo systemctl enable jenkins
sudo systemctl start jenkins
sudo systemctl status jenkins</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.重载Systemd配置</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl daemon-reload</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_为jenkins新增防火墙规则">4.4. 为Jenkins新增防火墙规则</h3>
<div class="paragraph">
<p>1.增加防火墙放行规则</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">YOURPORT=8080
PERM="--permanent"
SERV="$PERM --service=jenkins"

firewall-cmd $PERM --new-service=jenkins
firewall-cmd $SERV --set-short="Jenkins ports"
firewall-cmd $SERV --set-description="Jenkins port exceptions"
firewall-cmd $SERV --add-port=$YOURPORT/tcp
firewall-cmd $PERM --add-service=jenkins
firewall-cmd --zone=public --add-service=http --permanent</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">参数说明</div>
<p>YOURPORT</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Jenkins运行端口注意和 设置Jenkins启动参数 保持一致</pre>
</div>
</div>
<div class="paragraph">
<p>2.重载防火墙配置</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">firewall-cmd --reload</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_访问jenkins">4.5. 访问jenkins</h3>
<div class="paragraph">
<p>1.浏览器访问Jenkins <a href="http://localhost:8080" class="bare">http://localhost:8080</a> 出现以下界面</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/第一次访问jenkins.png" alt="第一次访问jenkins">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ssh">5. ssh</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_无密码登录">5.1. 无密码登录</h3>
<div class="listingblock">
<div class="title">无密码登录设置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#生成不带密码的密钥对
ssh-keygen -N "" -f ~/.ssh/mk

#上传公钥文件到远程主机
ssh-copy-id -i ~/.ssh/mk.pub root@192.168.2.236

#在本地Linux终端中配置私钥
cat &lt;&lt; EOF &gt;&gt; ~/.ssh/config
Host 192.168.2.236
    IdentityFile ~/.ssh/mk
EOF</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果是在gitlab中添加ssh公钥，则在克隆时必须在本地添加域名解析
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_ssh密钥对克隆git仓库">5.2. ssh密钥对克隆git仓库</h3>
<div class="listingblock">
<div class="title">生成密钥对</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p ~/.ssh
#一路回车直到生成
ssh-keygen -t rsa -b 4096 -C "chengzenghuan2018@gmail.com" -f ~/.ssh/keyname</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">参数说明</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>-t rsa 指定密钥对类型为RSA，</p>
</li>
<li>
<p>-b 4096 指定密钥长度为4096位，</p>
</li>
<li>
<p>-C "<a href="mailto:chengzenghuan@github.com">chengzenghuan@github.com</a>" 注释该密钥对相关联的电子邮件地址（公钥文件末尾会出现该注释）</p>
</li>
<li>
<p>-f ~/.ssh/keyname 指定密钥文件的名称和路径。</p>
</li>
<li>
<p>-N "" 指定空密码</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
将公钥keyname.pub添加到github后再执行之后的操作
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">配置ssh</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;&gt; ~/.ssh/config
Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/keyname
    IdentitiesOnly yes
EOF


#测试是否成功添加
ssh -T git@github.com</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>Hi xxxxx! You've successfully authenticated, but GitHub does not provide shell access.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果报错：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh: connect to host github.com port 22: Connection refused</pre>
</div>
</div>
<div class="paragraph">
<p>则使用GitHub的443端口————执行以下命令以更改~/.ssh/config文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;&gt; ~/.ssh/config
Host github.com
    HostName ssh.github.com
    Port 443
    User git
    IdentityFile ~/.ssh/keyname
    IdentitiesOnly yes
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>再次测试是否成功添加</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh -T git@github.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>成功后，终端输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hi xxxxx! You've successfully authenticated, but GitHub does not provide shell access.</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_cmd无法识别ssh">5.3. cmd无法识别ssh</h3>
<div class="ulist">
<ul>
<li>
<p>操作系统：Windows10</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>配置环境变量时，误操作导致cmd中无法使用ssh命令</p>
</div>
<div class="paragraph">
<p>添加环境变量即可解决。</p>
</div>
<div class="paragraph">
<p>此电脑&#8594;右键&#8594;属性&#8594;关于&#8594;高级系统设置&#8594;高级&#8594;环境变量</p>
</div>
<div class="paragraph">
<p>在系统变量Path中添加  <code>C:\Windows\System32\OpenSSH;</code></p>
</div>
<div class="paragraph">
<p>添加前：<code>%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin;</code></p>
</div>
<div class="paragraph">
<p>添加后：<code>%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin;
C:\Windows\System32\OpenSSH;</code></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prometheus">6. prometheus</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prometheus_2">6.1. Prometheus</h3>
<div class="paragraph">
<p>Reference： <a href="https://prometheus.io/docs/prometheus/latest/getting_started/#starting-up-some-sample-targets" class="bare">https://prometheus.io/docs/prometheus/latest/getting_started/#starting-up-some-sample-targets</a></p>
</div>
<div class="paragraph">
<p>手动下载地址： <a href="https://prometheus.io/download/#prometheus" class="bare">https://prometheus.io/download/#prometheus</a></p>
</div>
<div class="listingblock">
<div class="title">Download Prometheus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~
wget https://github.com/prometheus/prometheus/releases/download/v2.49.1/prometheus-2.49.1.linux-amd64.tar.gz
tar -zxvf prometheus-2.49.1.linux-amd64.tar.gz -C /opt/
cd /opt/prometheus-*</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行下面命令检测是否可以正常使用</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./prometheus --help</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Configuring Prometheus</div>
<p>在本quick start中省略不做，若有需要请查看
<a href="https://prometheus.io/docs/introduction/first_steps/">官方教程</a></p>
</div>
<div class="listingblock">
<div class="title">Starting Prometheus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./prometheus --config.file=prometheus.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>访问 <a href="http://&lt;部署prometheus的主机ip&gt;:9090" class="bare">http://&lt;部署prometheus的主机ip&gt;:9090</a></p>
</div>
<div class="listingblock">
<div class="title">常用命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#重载prometheus配置文件
kill -s SIGHUP `pgrep -f prometheus`

#关闭prometheus
kill -s SIGTERM `pgrep -f prometheus`</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prometheus_systemctl">6.2. prometheus-systemctl</h3>
<div class="paragraph">
<p>将prometheus添加到系统服务,便于用systemctl管理</p>
</div>
<div class="listingblock">
<div class="title">服务配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;/usr/lib/systemd/system/prometheus.service
[Unit]
Description = Prometheus server daemon

[Service]
Type = simple
WorkingDirectory = /opt/prometheus-2.49.1.linux-amd64
ExecStart = /opt/prometheus-2.49.1.linux-amd64/prometheus --config.file=/opt/prometheus-2.49.1.linux-amd64/prometheus.yml
ExecStop = /bin/kill -s SIGTERM  $MAINPID
ExecReload = /bin/kill -s SIGHUP  $MAINPID

[Install]
WantedBy=multi-user.target
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用systemctl管理prometheus</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 重载systemd管理器配置
sudo systemctl daemon-reload
sudo systemctl start prometheus.service
sudo systemctl enable prometheus.service
sudo systemctl reload prometheus.service</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="NODE_EXPORTER">6.3. node_exporter</h3>
<div class="paragraph">
<p>node_exporter手动下载地址： <a href="https://prometheus.io/download/#node_exporter" class="bare">https://prometheus.io/download/#node_exporter</a></p>
</div>
<div class="listingblock">
<div class="title">下载node_exporter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~
wget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz
tar -xzvf node_exporter-*.*.tar.gz -C /opt/
cd /opt/node_exporter-*.*</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">生成tls证书</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~
mkdir -p prometheus-tls
cd prometheus-tls
openssl req -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout node_exporter.key -out node_exporter.crt -subj "/C=CN/ST=Beijing/L=Beijing/O=Moelove.info/CN=localhost" -addext "subjectAltName = DNS:githubio"
cp *  /opt/node_exporter-*.*</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">编写配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;/opt/node_exporter-1.7.0.linux-amd64/config.yaml
tls_server_config:
  cert_file: node_exporter.crt
  key_file: node_exporter.key
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动node_exporter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /opt/node_exporter-*.*
./node_exporter --web.config.file=config.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>......
......
ts=2024-01-31T09:01:28.677Z caller=node_exporter.go:117 level=info collector=xfs
ts=2024-01-31T09:01:28.677Z caller=node_exporter.go:117 level=info collector=zfs
ts=2024-01-31T09:01:28.677Z caller=tls_config.go:274 level=info msg="Listening on" address=127.0.0.1:9101
ts=2024-01-31T09:01:28.677Z caller=tls_config.go:310 level=info msg="TLS is enabled." http2=true address=127.0.0.1:9100</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_node_exporter_systemctl">6.4. node_exporter-systemctl</h3>
<div class="paragraph">
<p><code>Ctrl-C</code> 停止程序，将node_exporter添加到系统服务,便于用systemctl管理</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; /usr/lib/systemd/system/node_exporter.service
[Unit]
Description = node_exporter server daemon

[Service]
Type = simple
ExecStart = /opt/node_exporter-1.7.0.linux-amd64/node_exporter --web.config.file=/opt/node_exporter-1.7.0.linux-amd64/config.yaml

[Install]
WantedBy=multi-user.target
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用systemctl管理node_exporter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># 重载systemd管理器配置
sudo systemctl daemon-reload

sudo systemctl start node_exporter
sudo systemctl enable node_exporter
sudo systemctl status node_exporter</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_prometheus获取node_exporter数据">6.5. Prometheus获取node_exporter数据</h3>
<div class="paragraph">
<p>添加上上步<a href="#NODE_EXPORTER">node_exporter</a>生成的node_exporter.crt到prometheus所在目录</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在prometheus主机上操作</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">为被添加的node设置域名解析</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;&gt;/etc/hosts
xxx.xxx.xxx.xxx githubio
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">复制node_exporter.crt到prometheus主机</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">scp root@node_exporter:~/prometheus-tls/node_exporter.crt /opt/prometheus-2.49.1.linux-amd64</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
设置域名解析必须做，否则会无法获取node_exporter信息
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>添加以下配置信息到/opt/prometheus-2.49.1.linux-amd64/prometheus.yml</p>
</div>
<div class="listingblock">
<div class="title">prometheus.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF&gt; /opt/prometheus-2.49.1.linux-amd64/prometheus.yml
global:
  scrape_interval:     15s # By default, scrape targets every 15 seconds.

  # Attach these labels to any time series or alerts when communicating with
  # external systems (federation, remote storage, Alertmanager).
  external_labels:
    monitor: 'codelab-monitor'

# A scrape configuration containing exactly one endpoint to scrape:
# Here it's Prometheus itself.
scrape_configs:
  # The job name is added as a label 'job=&lt;job_name&gt;' to any timeseries scraped from this config.
  - job_name: 'prometheus'

    # Override the global default and scrape targets from this job every 5 seconds.
    scrape_interval: 5s

    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'node_exporter'
    scheme: https
    tls_config:
      ca_file: node_exporter.crt
    static_configs:
    - targets: ['githubio:9100']

EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">此部分配置信息就是关于被添加node_exporter的</div>
<div class="content">
<pre>- job_name: 'node_exporter'
    scheme: https
    tls_config:
      ca_file: node_exporter.crt
    static_configs:
    - targets: ['githubio:9100']</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>- targets: ['githubio:9100']</code> 这里必须使用前面配置好的域名 <code>githubio</code>，不能用ip
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">重载prometheus配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo systemctl reload prometheus.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>访问 <a href="http://部署prometheus的主机Ip:9090/" class="bare">http://部署prometheus的主机Ip:9090/</a>
Status&#8594;Targets</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/prometheus_01.png" alt="prometheus 01">
</div>
<div class="title">Figure 1. 显示如图</div>
</div>
</div>
<div class="sect2">
<h3 id="_prometheussql">6.6. prometheusSql</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#cpu使用率
(1 - sum(rate(node_cpu_seconds_total{mode="idle"}[1m])) by (instance) / sum(rate(node_cpu_seconds_total[1m])) by (instance) ) * 100

#内存占用大小
node_memory_MemTotal_bytes{instance="githubio:9100", job="node_exporter-githubio"} - node_memory_MemFree_bytes{instance="githubio:9100", job="node_exporter-githubio"} - node_memory_Cached_bytes{instance="githubio:9100", job="node_exporter-githubio"} - node_memory_Buffers_bytes{instance="githubio:9100", job="node_exporter-githubio"}

#硬盘占用情况
node_filesystem_size_bytes{instance="githubio:9100", job="node_exporter-githubio", device!~"vmhgfs-fuse"} - node_filesystem_avail_bytes{instance="githubio:9100", job="node_exporter-githubio"}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_安装mysql_exporter">6.7. 安装mysql exporter</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.15.0/mysqld_exporter-0.15.0.linux-amd64.tar.gz
tar xvfz mysqld_exporter-0.15.0.linux-amd64.tar.gz</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">得到解压的文件</div>
<div class="content">
<pre>[pr@zabbix Download]$ ls
mysqld_exporter-0.15.0.linux-amd64         prometheus-2.46.0.linux-amd64
mysqld_exporter-0.15.0.linux-amd64.tar.gz  prometheus-2.46.0.linux-amd64.tar.gz</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd mysqld_exporter-0.15.0.linux-amd64</code></pre>
</div>
</div>
<div class="paragraph">
<p>root登陆数据库</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -ppassword</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建用户</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#更改密码策略，否则简单密码password不可用
mysql&gt;SET GLOBAL validate_password.policy = 0;
mysql&gt;CREATE USER 'exporter'@'localhost' IDENTIFIED BY 'password' WITH MAX_USER_CONNECTIONS 3;
mysql&gt;GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'exporter'@'localhost';
mysql&gt;quit;</code></pre>
</div>
</div>
<div class="paragraph">
<p>创建编辑文件.my.cnf</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo &lt;&lt; EOF &gt; .my.cnf
[client]
user=exporter
password=password
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>进入prometheus-2.46.0.linux-amd64目录下</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd prometheus-2.46.0.linux-amd64/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo &lt;&lt; EOF &gt;&gt; prometheus.yml
  - job_name: "mysqld"
    static_configs:
    - targets: ["localhost:9104"]
EOF
./mysqld_exporter --config.my-cnf=.my.cnf</code></pre>
</div>
</div>
<div class="paragraph">
<p>官网地址
<a href="https://prometheus.io/download/#mysqld_exporter" class="bare">https://prometheus.io/download/#mysqld_exporter</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zabbix">7. Zabbix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_选择zabbix服务器的平台">7.1. 选择Zabbix服务器的平台</h3>
<div class="paragraph">
<p>选择zabbix服务器平台以获得对应的rpm包</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
选择的服务器平台不同，操作也会不同，本教程选择如下
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-选择zabbix服务器平台.png" alt="01 选择zabbix服务器平台">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_安装配置zabbix">7.2. 安装配置zabbix</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果你安装了EPEL，则需要禁用EPEL提供的zabbix包
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>编辑配置文件 /etc/yum.repos.d/epel.repo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/yum.repos.d/epel.repo</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后添加下列内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[epel]
...
excludepkgs=zabbix*</pre>
</div>
</div>
<div class="paragraph">
<p>1.安装zabbix仓库</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rpm -Uvh https://repo.zabbix.com/zabbix/6.4/rhel/9/x86_64/zabbix-release-6.4-1.el9.noarch.rpm
dnf clean all</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.安装Zabbix server，Web前端，agent</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dnf install zabbix-server-mysql zabbix-web-mysql zabbix-apache-conf zabbix-sql-scripts zabbix-selinux-policy zabbix-agent</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.创建初始数据库
    需要确保有数据库服务已启动并运行
在数据库主机上运行以下代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -p
password
mysql&gt; SET GLOBAL validate_password.policy = 0;
mysql&gt; create database zabbix character set utf8mb4 collate utf8mb4_bin;
mysql&gt; create user zabbix@localhost identified by 'password';
mysql&gt; grant all privileges on zabbix.* to zabbix@localhost;
mysql&gt; set global log_bin_trust_function_creators = 1;
mysql&gt; quit;</code></pre>
</div>
</div>
<div class="paragraph">
<p>导入初始架构和数据，系统将提示您输入新创建的密码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql --default-character-set=utf8mb4 -uzabbix -p zabbix</code></pre>
</div>
</div>
<div class="paragraph">
<p>在导入数据库模式后禁用日志bin信任功能创建者选项。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql -uroot -p
password
mysql&gt; set global log_bin_trust_function_creators = 0;
mysql&gt; quit;</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.为Zabbix server配置数据库
编辑配置文件 /etc/zabbix/zabbix_server.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/zabbix/zabbix_server.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>DBPassword=password</pre>
</div>
</div>
<div class="paragraph">
<p>5.启动Zabbix server和agent进程
启动Zabbix server和agent进程，并为它们设置开机自启：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart zabbix-server zabbix-agent httpd php-fpm
systemctl enable zabbix-server zabbix-agent httpd php-fpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>6.打开zabbix的web UI
使用Apache web server时，Zabbix UI的默认URL是
<a href="http://host/zabbix" class="bare">http://host/zabbix</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_快速开始">7.3. 快速开始</h3>
<div class="paragraph">
<p>1.登录和配置用户</p>
</div>
<div class="paragraph">
<p>概览：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>本章节你将学会如何登录和设立Zabbix中的系统用户</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-zabbix登录页.png" alt="02 zabbix登录页">
</div>
<div class="title">Figure 2. 登录界面</div>
</div>
<div class="paragraph">
<p>输入以下用户名和密码登录为Zabbix超级用户</p>
</div>
<div class="paragraph">
<p>用户名：Admin
密码：zabbix</p>
</div>
<div class="paragraph">
<p>最后进入zabbix首页</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-zabbix首页.png" alt="03 zabbix首页">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zabbixmysql">7.4. Zabbix+Mysql</h3>
<div class="sect3">
<h4 id="_overview">7.4.1. Overview</h4>
<div class="paragraph">
<p>该template的设计是为了让Zabbix通过Zabbix agent监控MySQL更简单
，不需要其他任何插件就可以实现</p>
</div>
</div>
<div class="sect3">
<h4 id="_requirements">7.4.2. Requirements</h4>
<div class="paragraph">
<p>Zabbix version: 6.4 and higher.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tested_versions">7.4.3. Tested versions</h4>
<div class="paragraph">
<p><strong>该template 测试在：</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>mysql  Ver 8.0.34</p>
</li>
<li>
<p>Zabbix version: 6.4</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_setup">7.4.4. Setup</h4>
<div class="paragraph">
<p>1.
<a href="https://book.cdgeekcamp.com/geekcamp-web-newbie-tutorial/#%E5%AE%89%E8%A3%85MySQL">安装Mysql client</a></p>
</div>
<div class="paragraph">
<p>2.复制userparameter_mysql.conf到另一个目录下并改名为template_db_mysql.conf</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp /usr/share/doc/zabbix-agent/userparameter_mysql.conf /etc/zabbix/zabbix_agentd.d/template_db_mysql.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.重启Zabbix agent</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart zabbix-agent</code></pre>
</div>
</div>
<div class="paragraph">
<p>4.创建一个MySQL user用于监控</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql&gt;CREATE USER 'zbx_monitor'@'%' IDENTIFIED BY 'password';
mysql&gt;GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO 'zbx_monitor'@'%';</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.创建/var/lib/zabbix/.my.cnf</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir /var/lib/zabbix

cat &lt;&lt; EOF &gt;/var/lib/zabbix/.my.cnf
[client]
user='zbx_monitor'
password='password'
EOF</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_start">7.4.5. Start</h4>
<div class="paragraph">
<p>进入zabbix主页
<a href="http://host/zabbix" class="bare">http://host/zabbix</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-zabbix首页.png" alt="03 zabbix首页">
</div>
</div>
<div class="paragraph">
<p>左侧菜单栏&#8594;monitoring&#8594;Hosts&#8594;Create host</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-createhost.png" alt="04 createhost">
</div>
</div>
<div class="paragraph">
<p>&#8594;update</p>
</div>
<div class="paragraph">
<p>创建完成后如图,有名为mysql的host</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-createdhost.png" alt="05 createdhost">
</div>
</div>
<div class="paragraph">
<p>点击该主机名，查看详细数据，点击item</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/06-查看数据.png" alt="06 查看数据">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-itemlist.png" alt="07 itemlist">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zhiyan_mod_letsencrypt">8. zhiyan-mod-letsencrypt</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_配置zhiyan_mod_letsencrypt">8.1. 配置zhiyan-mod-letsencrypt</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyanmodule/zhiyan-mod-letsencrypt.git
cd zhiyan-mod-letsencrypt
pycharm .</code></pre>
</div>
</div>
<div class="paragraph">
<p>将conf文件下的letsencrypt.conf.sample复制一份并改名为letsencrypt.conf，并参照以下提示进行更改
找到下面参数：</p>
</div>
<div class="paragraph">
<p>1.将</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dry_run = no</code></pre>
</div>
</div>
<div class="paragraph">
<p>改为</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dry_run = yes</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.将</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">language_file=/opt/gc/zy/etc/language/zh_CN/letsencrypt.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>改为</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">language_file=/home/czh/workspace/github/zhiyan-mod-letsencrypt/language/zh_CN/letsencrypt.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>将该文件中的所有</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">level = INFO</code></pre>
</div>
</div>
<div class="paragraph">
<p>改为</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">level = TRACE</code></pre>
</div>
</div>
<div class="paragraph">
<p>将需要分析的log文件保存到本地的/var/log/letsencrypt/下(需要分析的log文件通常在服务器的/var/log/letsencrypt目录下)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /var/log/letsencrypt/
scp root@8.210.45.121:/var/log/letsencrypt/letsencrypt.log /var/log/letsencrypt/</code></pre>
</div>
</div>
<div class="paragraph">
<p>将已完成证书签发的服务器上的/etc/letsencrypt目录保存到本地的/etc/letsencrypt</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">scp -r root@8.210.45.121:/etc/letsencrypt /etc/letsencrypt</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_安装zysdk">8.2. 安装zySDK</h3>
<div class="paragraph">
<p>1.克隆所需的项目</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyan/libzygrpc.git
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyan/libzymod-python.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.进入libzymod-python目录进行以下操作</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/libzymod-python/
git checkout dev
git pull origin dev
sh build.sh
cd dist/
pip install zymod-0.0.2.3-py3-none-any.whl</code></pre>
</div>
</div>
<div class="paragraph">
<p>3.安装以下版本的依赖</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install grpcio==1.57.0
pip install grpcio-tools==1.57.0
pip install protobuf==4.21.12
pip install setuptool==68.0.0</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
setuptool可以使用更低版本如
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>4.在libzygrpc目录下进行以下操作</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/libzygrpc/
git checkout dev
git pull origin dev
cd python/
sh build.sh
cd dist/
pip install zygrpc-0.0.1.15-py3-none-any.whl</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在准备好了所有环境，回到pycharm查看是否还有依赖不存在的问题，没有报错后，回到zhiyan-mod-letsencrypt目录下继续操作</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/zhiyan-mod-letsencrypt
python zymod_letsencrypt.py -c /home/czh/workspace/github/zhiyan-mod-letsencrypt/conf/letsencrypt.conf</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">屏幕输出如下</div>
<div class="content">
<pre>[czh@archlinux zhiyan-mod-letsencrypt]$ python zymod_letsencrypt.py -c /home/czh/workspace/github/zhiyan-mod-letsencrypt/conf/letsencrypt.conf
2023-08-28 19:55:45 26872 [INFO] 未启用日志配置文件，加载默认设置
2023-08-28 19:55:45 26872 [INFO] 日志配置文件 '/home/czh/workspace/github/zhiyan-mod-letsencrypt/conf/letsencrypt.conf' 加载成功
2023-08-28 19:55:45 26872 [INFO] 查找自动续签定时任务设置：当前模式-&gt;systemd
2023-08-28 19:55:45 26872 [TRACE] Enter function: get_timer_prop
2023-08-28 19:55:45 26872 [TRACE] Enter function: __calc_next_elapse
2023-08-28 19:55:45 26872 [TRACE] input-&gt;now_ts=1693223745.7171829
2023-08-28 19:55:45 26872 [TRACE] input-&gt;now_monotonic_ts=39455.986456076
2023-08-28 19:55:45 26872 [TRACE] input-&gt;next_usec=1693238400000000
2023-08-28 19:55:45 26872 [TRACE] input-&gt;next_monotonic_usec=0
2023-08-28 19:55:45 26872 [TRACE] var-&gt;next_ts=1693238400.0
2023-08-28 19:55:45 26872 [TRACE] var-&gt;next_monotonic_ts=0.0
2023-08-28 19:55:45 26872 [TRACE] output-&gt;result=1693238400.0
2023-08-28 19:55:45 26872 [TRACE] Exit function: __calc_next_elapse
2023-08-28 19:55:45 26872 [TRACE] output-&gt;result=ZySystemdTimerProp(timer_name='letsencrypt.timer', unit_name='letsencrypt.service', timers_calendar=[('OnCalendar', '*-*-* 00:00:00')], next_elapse=datetime.datetime(2023, 8, 29, 0, 0), last_trigger=datetime.datetime(1970, 1, 1, 8, 0), result='success', persistent=True, wake_system=False)
2023-08-28 19:55:45 26872 [TRACE] Exit function: get_timer_prop
2023-08-28 19:55:45 26872 [TRACE] Enter function: get_last_result_from_log
2023-08-28 19:55:45 26872 [TRACE] input-&gt;log_file=/var/log/letsencrypt/letsencrypt.log
2023-08-28 19:55:45 26872 [TRACE] var-&gt;_log_file=/var/log/letsencrypt/letsencrypt.log
2023-08-28 19:55:45 26872 [TRACE] var-&gt;result=(True, datetime.datetime(2023, 8, 25, 9, 33, 19))
2023-08-28 19:55:45 26872 [TRACE] output-&gt;result=(True, datetime.datetime(2023, 8, 25, 9, 33, 19), '/var/log/letsencrypt/letsencrypt.log')
2023-08-28 19:55:45 26872 [TRACE] Exit function: get_last_result_from_log
2023-08-28 19:55:45 26872 [TRACE] var-&gt;last_run=1970-01-01 08:00:00
2023-08-28 19:55:45 26872 [TRACE] var-&gt;next_running=2023-08-29 00:00:00
2023-08-28 19:55:45 26872 [TRACE] Enter function: mod_send_request_grpc
2023-08-28 19:55:45 26872 [TRACE] var-&gt;name=letsencrypt
2023-08-28 19:55:45 26872 [TRACE] var-&gt;datetime=2023-08-28 11:55:45.724902+00:00
2023-08-28 19:55:45 26872 [DEBUG] content=
{
    "Certificates": [
        {
            "Certificate": {
                "Issued By": {
                    "Common Name": "R3",
                    "Organization": "Let's Encrypt",
                    "Organization Unit": "&lt;未包含在证书中&gt;"
                },
                "Issued To": {
                    "Common Name": "*.chengzenghuan.asia",
                    "Organization": "&lt;未包含在证书中&gt;",
                    "Organization Unit": "&lt;未包含在证书中&gt;"
                },
                "Subject Alternative Name": {
                    "DNS Names": [
                        "*.chengzenghuan.asia"
                    ]
                },
                "Validity Period": {
                    "Expires On": "2023-11-23 05:26:20",
                    "Issued On": "2023-08-25 05:26:21",
                    "Time Left": "86天17时30分34秒"
                }
            },
            "Certificate Path": "/etc/letsencrypt/live/chengzenghuan.asia/fullchain.pem",
            "Domain": "*.chengzenghuan.asia",
            "Private Key Path": "/etc/letsencrypt/live/chengzenghuan.asia/privkey.pem",
            "Private Key Type": "ECDSA",
            "Root Certificate Path": "/etc/letsencrypt/live/chengzenghuan.asia/chain.pem"
        }
    ],
    "CertificatesTitleColName": "Domain",
    "RenewalTimerState": {
        "Activate": "letsencrypt.service",
        "LastRan": "1970-01-01 08:00:00",
        "LastRanResult": true,
        "Left": "4 h, 4 min, 14 sec",
        "NextRunning": "2023-08-29 00:00:00",
        "Passed": "19597 days, 11 h, 55 min, 45 sec",
        "RenewalLogFile": "/var/log/letsencrypt/letsencrypt.log",
        "RenewalResult": true,
        "RenewalTime": "2023-08-25 09:33:19",
        "SystemTime": "2023-08-28 19:55:45",
        "TimerName": "letsencrypt.timer"
    }
}
2023-08-28 19:55:45 26872 [INFO] zymod：试运行中，不进行注册.....
2023-08-28 19:55:45 26872 [TRACE] Exit function: mod_send_request_grpc</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zhiyan_mod_php_fpm">9. zhiyan-mod-php-fpm</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_克隆_zhiyan_mod_php_fpmlibzygrpclibzymod_rust">9.1. 克隆 zhiyan-mod-php-fpm、libzygrpc、libzymod-rust</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYanModule
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyanmodule/zhiyan-mod-php-fpm.git
cd zhiyan-mod-php-fpm
git checkout dev
git pull origin dev

cd /home/czh/workspace/github/ZhiYan
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyan/libzymod-rust.git
cd libzymod-rust
git checkout dev
git pull origin dev

git clone ssh://git@git.cdgeekcamp.com:4295/zhiyan/libzygrpc.git
cd libzygrpc
git checkout dev
git pull origin dev</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
每个项目都要切换分支并拉取最新代码
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_配置zhiyan_mod_php_fpm">9.1.1. 配置zhiyan-mod-php-fpm</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYan
cat &lt;&lt; EOF &gt; Cargo.toml
[workspace]
members = ["libzymod-rust"]
exclude = ["libzygrpc", "nginx-access-log-parser", "nginx-error-log-parser"]

[patch]
[patch.crates-io]
[patch.crates-io.libzymod-rust]
path = "/home/czh/workspace/github/ZhiYan/libzymod-rust"

[patch.crates-io.libzygrpc]
path = "/home/czh/workspace/github/ZhiYan/libzygrpc/rust"
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYanModule
cat &lt;&lt; EOF &gt;Cargo.toml
[workspace]

members = [
    "zhiyan-mod-php-fpm",
]

[patch.crates-io]
libzymod-rust = { path = '/home/czh/workspace/github/ZhiYan/libzymod-rust' }
libzygrpc = { path = '/home/czh/workspace/github/ZhiYan/libzygrpc/rust' }
EOF</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rust">9.2. RUST</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
RUST安装与使用参照
<a href="https://fifilyu.github.io/seia/#_Rust_chapter">此文档</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_编译zhiyan_mod_php_fpm并运行">9.3. 编译zhiyan-mod-php-fpm并运行</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYan/libzygrpc/rust
p cargo build

cd /home/czh/workspace/github/ZhiYan/libzymod-rust
p cargo build

cd /home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm
p cargo build</code></pre>
</div>
</div>
<div class="paragraph">
<p>切换到/home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm目录,执行以下命令可以得到一个可执行文件</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm
cargo run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre>warning: `zhiyan-mod-php-fpm` (bin "zhiyan-mod-php-fpm") generated 1 warning
    Finished dev [unoptimized + debuginfo] target(s) in 0.08s
     Running `/home/czh/workspace/github/ZhiYanModule/target/debug/zhiyan-mod-php-fpm`
2023-08-29 19:29:08 30984 [WARN] 检测到日志配置文件'/opt/gc/zy/etc/php-fpm_log.yaml'不存在,将加载默认设置(Level：Debug)
2023-08-29 19:29:08 30984 [ERROR] 检测到智眼模块配置文件'/opt/gc/zy/etc/php-fpm.conf'不存在</pre>
</div>
</div>
<div class="paragraph">
<p>可执行文件为</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/home/czh/workspace/github/ZhiYanModule/target/debug/zhiyan-mod-php-fpm</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行以下命令就可以查看帮助信息</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/home/czh/workspace/github/ZhiYanModule/target/debug/zhiyan-mod-php-fpm --help</code></pre>
</div>
</div>
<div class="paragraph">
<p>更改zhiyan-mod-php-fpm/conf下的配置文件</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm/conf
mv php-fpm.conf.sample php-fpm.conf
mv php-fpm.log.yaml.sample php-fpm.log.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.修改php-fpm.conf文件</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim php-fpm.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>更改以下内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">将
language_file=/opt/gc/zy/etc/language/zh_CN/php-fpm.json
改为
language_file=/home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm/language/zh_CN/php-fpm.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.修改php-fpm.log.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim php-fpm.log.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>将
level: error
改为
level: trace</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /var/log/php
touch /var/log/php/errors.log
chown -R czh:czh /var/log/php/errors.log

cd /home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm
mkdir var/log
touch var/log/php-fpm.log/php-fpm.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>执行</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">/home/czh/workspace/github/ZhiYanModule/target/debug/zhiyan-mod-php-fpm -c  /home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm/conf/php-fpm.conf -l /home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm/conf/php-fpm.log.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre>[czh@archlinux php-fpm.d]$ /home/czh/workspace/github/ZhiYanModule/target/debug/zhiyan-mod-php-fpm -c  /home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm/conf/php-fpm.conf -l /home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm/conf/php-fpm.log.yaml
log4rs: error deserializing appender file: Permission denied (os error 13)
log4rs: Reference to nonexistent appender: `file`
2023-08-29 19:57:48 32333 [INFO] 日志配置文件'/home/czh/workspace/github/ZhiYanModule/zhiyan-mod-php-fpm/conf/php-fpm.log.yaml'加载成功。
2023-08-29 19:57:48 32333 [INFO] Code:"1",Messages:"phpfpm模块注册失败，Agent连接失败,十秒后进行下一次尝试,Error Message:transport error"
2023-08-29 19:57:58 32333 [INFO] Code:"1",Messages:"phpfpm模块注册失败，Agent连接失败,十秒后进行下一次尝试,Error Message:transport error"</pre>
</div>
</div>
<div class="paragraph">
<p>安装配置php-fpm</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo pacman -Syy
sudo pacman -S  extra/php-fpm
systemctl enable php-fpm.service
systemctl start php-fpm.service
systemctl status php-fpm.service

vim /etc/php/php-fpm.d/www.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>删除258行的第一个符号‘；’</p>
</div>
<div class="listingblock">
<div class="content">
<pre>255 ;       anything, but it may not be a good idea to use the .php extension or it
256 ;       may conflict with a real PHP file.
257 ; Default Value: not set
258 ;pm.status_path = /status
259
260 ; The address on which to accept FastCGI status request. This creates a new
261 ; invisible pool that can handle requests independently. This is useful</pre>
</div>
</div>
<div class="paragraph">
<p>重启php-fpm.service</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart php-fpm.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置nginx</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/nginx/nginx.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>在文件末尾最后一个}符号的上一行添加如下内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    server {
    listen       8023;
    server_name  _;
    root         /usr/share/nginx/html;
    location ~ ^/status$ {
        fastcgi_pass unix://run/php-fpm/php-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
        allow 127.0.0.1;
        deny all;
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>接下来访问
<a href="http://localhost:8023/status?json" class="bare">http://localhost:8023/status?json</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grpcpython">10. grpc+python</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_快速开始_2">10.1. 快速开始</h3>
<div class="sect3">
<h4 id="_环境准备">10.1.1. 环境准备</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
以下命令匀在root下执行
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
 <code>python -m ensurepip</code>
检查当前Python环境中是否已经安装了pip。如果没有安装，则会自动下载并安装最新版本的pip
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>更新pip版本</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python -m pip install --upgrade pip</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_安装grpc">10.1.2. 安装gRPC</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python -m pip install grpcio</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_grpc_tools">10.1.3. gRPC tools</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python -m pip install grpcio-tools</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_下载example">10.1.4. 下载example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone -b v1.57.0 --depth 1 --shallow-submodules https://github.com/grpc/grpc
cd grpc/examples/python/helloworld</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_运行_grpc_应用">10.1.5. 运行 gRPC 应用</h4>
<div class="paragraph">
<p>进入 <code>examples/python/helloworld</code> 目录</p>
</div>
<div class="paragraph">
<p>1.运行server</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python greeter_server.py</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>[root@gitserver helloworld]# python greeter_server.py
Server started, listening on 50051</pre>
</div>
</div>
<div class="paragraph">
<p>2.在另一个终端同一目录下运行client</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python greeter_client.py</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>[root@gitserver helloworld]# python greeter_client.py
Will try to greet world ...
Greeter client received: Hello, you!</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_更新grpc_service">10.1.6. 更新gRPC service</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim examples/protos/helloworld.proto</code></pre>
</div>
</div>
<div class="paragraph">
<p>添加
<code>// Sends another greeting
  rpc SayHelloAgain (HelloRequest) returns (HelloReply) {}</code>
到下列文字标识处</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}

  *添加到此处*

  //rpc SayHelloStreamReply (HelloRequest) returns (stream HelloReply) {}
}</pre>
</div>
</div>
<div class="paragraph">
<p>添加后变成</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}

  // Sends another greeting
  rpc SayHelloAgain (HelloRequest) returns (HelloReply) {}

  //rpc SayHelloStreamReply (HelloRequest) returns (stream HelloReply) {}
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_生成grpc代码">10.1.7. 生成gRPC代码</h4>
<div class="paragraph">
<p>进入 <code>examples/python/helloworld</code> 目录，执行下列命令</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python -m grpc_tools.protoc -I../../protos --python_out=. --pyi_out=. --grpc_python_out=. ../../protos/helloworld.proto</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_更新并运行该应用">10.1.8. 更新并运行该应用</h4>
<div class="paragraph">
<p>1.更新server
在相同目录下，编辑greeter_server.py</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim greeter_server.py</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>class Greeter(helloworld_pb2_grpc.GreeterServicer):

  def SayHello(self, request, context):
    return helloworld_pb2.HelloReply(message=f'Hello, {request.name}!')

  def SayHelloAgain(self, request, context):
    return helloworld_pb2.HelloReply(message=f'Hello again, {request.name}!')
...</pre>
</div>
</div>
<div class="paragraph">
<p>在上面代码中，已经添加了下面这段代码</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  def SayHelloAgain(self, request, context):
    return helloworld_pb2.HelloReply(message=f'Hello again, {request.name}!')</pre>
</div>
</div>
<div class="paragraph">
<p>2.更新client
在相同目录下，编辑greeter_client.py</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim greeter_client.py</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>def run():
    with grpc.insecure_channel('localhost:50051') as channel:
        stub = helloworld_pb2_grpc.GreeterStub(channel)
        response = stub.SayHello(helloworld_pb2.HelloRequest(name='you'))
        print("Greeter client received: " + response.message)
        response = stub.SayHelloAgain(helloworld_pb2.HelloRequest(name='you'))
        print("Greeter client received: " + response.message)</pre>
</div>
</div>
<div class="paragraph">
<p>上面代码中，已经添加了下面这段代码</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        response = stub.SayHelloAgain(helloworld_pb2.HelloRequest(name='you'))
        print("Greeter client received: " + response.message)</pre>
</div>
</div>
<div class="paragraph">
<p>3.运行</p>
</div>
<div class="paragraph">
<p>到 <code>examples/python/helloworld</code> 这个目录下</p>
</div>
<div class="paragraph">
<p>(1)运行server</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python greeter_server.py</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>[root@gitserver helloworld]# python greeter_server.py
Server started, listening on 50051</pre>
</div>
</div>
<div class="paragraph">
<p>在另一个终端中的相同目录下</p>
</div>
<div class="paragraph">
<p>(2)运行client</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python greeter_client.py</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>[root@gitserver helloworld]# python greeter_client.py
Will try to greet world ...
Greeter client received: Hello, you!
Greeter client received: Hello again, you!</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zhiyan_mod_iptables">11. zhiyan-mod-iptables</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zhiyan_mod_iptables_2">11.1. zhiyan-mod-iptables</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">su root
python -m pip install --upgrade pip
pip install python-iptables --break-system-packages</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python
&gt;&gt;&gt; import iptc
&gt;&gt;&gt; iptc.easy.dump_chain('filter', 'OUTPUT', ipv6=False)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre>[{'target': 'LIBVIRT_OUT', 'counters': (100462, 12548250)}]</pre>
</div>
</div>
<div class="paragraph">
<p>输出nat table</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt;&gt;&gt; iptc.easy.dump_table('nat', ipv6=False)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre>&gt;&gt;&gt; iptc.easy.dump_table('nat', ipv6=False)
{'PREROUTING': [{'addrtype': {'dst-type': 'LOCAL'}, 'target':
.....
.....
.....
.....
.....
.....
24', 'target': 'MASQUERADE', 'counters': (0, 0)}]}</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zhiyan">12. zhiyan</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zhiyan_web_flutter">12.1. zhiyan-web-flutter</h3>
<div class="listingblock">
<div class="title">克隆</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pacman -S flutter

cd /home/czh/workspace/github/ZhiYanModule
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyan/zhiyan-web-flutter.git
cd zhiyan-web-flutter
git checkout dev
git pull origin dev

flutter build web --release --web-renderer html</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>Font asset "CupertinoIcons.ttf" was tree-shaken, reducing it from 283452 to 1272 bytes (99.6% reduction). Tree-shaking can be disabled
by providing the --no-tree-shake-icons flag when building your app.
Font asset "MaterialIcons-Regular.otf" was tree-shaken, reducing it from 1645184 to 10028 bytes (99.4% reduction). Tree-shaking can be
disabled by providing the --no-tree-shake-icons flag when building your app.
Compiling lib/main.dart for the Web...                             26.4s</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd build/web
python -m http.server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</pre>
</div>
</div>
<div class="paragraph">
<p>访问链接
<a href="http://0.0.0.0:8000/" class="bare">http://0.0.0.0:8000/</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-智眼登录页.png" alt="01 智眼登录页">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zhiyan_web_server">12.2. zhiyan-web-server</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYanModule
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyan/zhiyan-web-server.git
cd zhiyan-web-server
cp src/main/resources/application.properties.sample src/main/resources/application.properties
vim src/main/resources/application.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>更改</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.datasource.url=jdbc:postgresql://127.0.0.1:5432/zhiyan
spring.datasource.username=zy
spring.datasource.password=geek</pre>
</div>
</div>
<div class="paragraph">
<p>更改</p>
</div>
<div class="listingblock">
<div class="content">
<pre>logging.config=/home/czh/workspace/temp/zhiyan-web-server/src/main/resources/logback.xml

# 用户头像保存目录
application.config.user-photo-save-dir=/home/czh/workspace/temp/zhiyan-web-server/var/images/avatar</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp src/main/resources/logback.xml.sample src/main/resources/logback.xml
vim src/main/resources/logback.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>更改</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;file&gt;/home/czh/workspace/temp/zhiyan-web-server/var/log/web-server.log&lt;/file&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn spring-boot:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>终端末尾输出</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-zhiyan-web-server.png" alt="02 zhiyan web server">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cargo_toml">12.3. Cargo.toml</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYan
cat &lt;&lt; EOF &gt; Cargo.toml
[workspace]
members = ["libzymod-rust"]
exclude = ["libzygrpc", "nginx-access-log-parser", "nginx-error-log-parser"]

[patch]
[patch.crates-io]
[patch.crates-io.libzymod-rust]
path = "/home/czh/workspace/github/ZhiYan/libzymod-rust"

[patch.crates-io.libzygrpc]
path = "/home/czh/workspace/github/ZhiYan/libzygrpc/rust"
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYanModule
cat &lt;&lt; EOF &gt;Cargo.toml
[workspace]

members = [
    "zhiyan-mod-php-fpm",
]

[patch.crates-io]
libzymod-rust = { path = '/home/czh/workspace/github/ZhiYan/libzymod-rust' }
libzygrpc = { path = '/home/czh/workspace/github/ZhiYan/libzygrpc/rust' }
EOF</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zhiyan_agent">12.4. zhiyan-agent</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYanModule
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyan/zhiyan-agent.git
cd zhiyan-agent
git checkout dev
git pull origin dev

cp conf/agent.conf.sample conf/agent.conf
vim conf/agent.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>更改conf/agent.conf文件中的以下内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre>agent_host=192.168.2.134
server_host=192.168.2.134
host=192.168.2.134
token=YmY0MD********************MGQ2OGI3MTEyODNiYjAyZGJjMA==</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp conf/agent.log.yaml.sample conf/agent.log.yaml
cargo build --release

cd ../target/release/
./zhiyan-agent -c /home/czh/workspace/github/ZhiYanModule/zhiyan-agent/conf/agent.conf -l /home/czh/workspace/github/ZhiYanModule/zhiyan-agent/conf/agent.log.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zhian_server">12.5. zhian-server</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/czh/workspace/github/ZhiYanModule
git clone ssh://git@git.cdgeekcamp.com:4295/zhiyan/zhiyan-server.git
cd zhiyan-server
git checkout dev
git pull origin dev

cp conf/server.conf.sample conf/server.conf
vim conf/server.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>更改conf/server.conf文件中的以下内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre>postgresql_username=zy
postgresql_password=geek
postgresql_host=localhost
postgresql_port=5432
postgresql_database=zhiyan</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp conf/server.log.yaml.sample conf/server.log.yaml
cargo build --release

cd ../target/release/

./zhiyan-server -c /home/czh/workspace/github/ZhiYanModule/zhiyan-server/conf/server.conf -l /home/czh/workspace/github/ZhiYanModule/zhiyan-server/conf/server.log.yaml</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zhiyan_mod">13. zhiyan-mod</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zhiyan_mod_cpu">13.1. zhiyan-mod-cpu</h3>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_python">14. Python</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_centos9_install_python311">14.1. CentOS9 Install Python311</h3>
<div class="sect3">
<h4 id="_编译安装">14.1.1. 编译安装</h4>
<div class="listingblock">
<div class="title">环境准备</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir ~/downloads
dnf install -y gcc gcc-c++ make libffi-devel bzip2-devel readline-devel ncurses-devel tcl-devel tcl libuuid-devel zlib-devel zlib xz-devel xz tk-devel tk openssl-devel sqlite-devel</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装Python</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd  ~/downloads
wget --no-check-certificate https://www.python.org/ftp/python/3.11.5/Python-3.11.5.tar.xz
tar xf Python-3.11.5.tar.xz
cd Python-3.11.5
./configure --prefix=/usr/local/python-3.11.5 \
    --enable-optimizations \
    --with-ensurepip \
    --enable-loadable-sqlite-extensions
make
make install


ln -s /usr/local/python-3.11.5 /usr/local/python3
ln -s /usr/local/python3/bin/pip3 /usr/local/bin/gpip
ln -s /usr/local/python3/bin/python3 /usr/local/bin/gpy

gpip install --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simple pip
gpip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_python版本管理">14.2. Python版本管理</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
该部分提供思路，不可直接使用
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#查看当前电脑上有多少个版本的python
[root@192 workspace]# ls /usr/bin/python*

#建立软链接更改使用的python
[root@192 workspace]# ln -s /usr/bin/python3.9 python
#或者
[root@192 workspace]# ln -s /usr/bin/python311 python

更改pip安装库的位置
[root@192 workspace]# which pip
/usr/bin/pip
[root@192 workspace]# realpath  /usr/local/bin/gpip
/usr/local/python-3.11.5/bin/pip3

#建立软链接更改使用的python
[root@192 workspace]# ln -s /usr/local/python-3.11.5/bin/pip3 /usr/bin/pip</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Terminal_chapter">15. Terminal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zsr">15.1. zsr</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo pacman -S check
cd /home/czh/workspace/github
git clone  git@github.com:fifilyu/zsr.git
cd zsr
cmake .
make
make install
cd bin
./zsr -c 5 --cpu</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>cpu=0.00,0.00,0.00;
cpu=98.98,1.02,0.00;
cpu=98.71,1.29,0.00;
cpu=99.11,0.89,0.03;</pre>
</div>
</div>
<div class="paragraph">
<p>添加到环境变量</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo 'export PATH=$PATH:~/workspace/github/zsr/bin' &gt;&gt; ~/.bashrc
source ~/.bashrc</code></pre>
</div>
</div>
<div class="paragraph">
<p>在任何路径执行</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">zsr -c 5 --cpu</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>cpu=0.00,0.00,0.00;
cpu=98.98,1.02,0.00;
cpu=98.71,1.29,0.00;
cpu=99.11,0.89,0.03;</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mqtt">16. MQTT</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_mqttdemo">16.1. MQTTdemo</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install paho-mqtt</code></pre>
</div>
</div>
<div class="paragraph">
<p>该demo本人运行在centos stream 9</p>
</div>
<div class="paragraph">
<p>安装mosquitto(MQTT的broker)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install mosquitto
systemctl status mosquitto.service

cat &lt;&lt;EOF &gt;&gt;/etc/mosquitto/mosquitto.conf
allow_anonymous
listener 1883 0.0.0.0
EOF

systemctl restart mosquitto.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>在一个终端subscribe</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mosquitto_sub -t 'test/topic' -v</code></pre>
</div>
</div>
<div class="paragraph">
<p>在另一个终端publish</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mosquitto_pub -t 'test/topic' -m 'hello world'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在执行subscribe的终端输出</div>
<div class="content">
<pre>[root@master ~]# mosquitto_sub -t 'test/topic' -v
test/topic hello world</pre>
</div>
</div>
<div class="paragraph">
<p>出现以上内容则mosquitto搭建成功</p>
</div>
<div class="paragraph">
<p>subscribe.py</p>
</div>
<div class="listingblock">
<div class="content">
<pre># python3.6

import random

from paho.mqtt import client as mqtt_client


#broker = 'broker.emqx.io'
broker = '192.168.122.254'
port = 1883
topic = "python/mqtt"
# Generate a Client ID with the subscribe prefix.
client_id = f'subscribe-{random.randint(0, 100)}'
# username = 'emqx'
# password = 'public'


def connect_mqtt() -&gt; mqtt_client:
    def on_connect(client, userdata, flags, rc):
        if rc == 0:
            print("Connected to MQTT Broker!")
        else:
            print("Failed to connect, return code %d\n", rc)

    client = mqtt_client.Client(client_id)
    # client.username_pw_set(username, password)
    client.on_connect = on_connect
    client.connect(broker, port)
    return client


def subscribe(client: mqtt_client):
    def on_message(client, userdata, msg):
        print(f"Received `{msg.payload.decode()}` from `{msg.topic}` topic")

    client.subscribe(topic)
    client.on_message = on_message


def run():
    client = connect_mqtt()
    subscribe(client)
    client.loop_forever()



if __name__ == '__main__':
    run()</pre>
</div>
</div>
<div class="paragraph">
<p>publish.py</p>
</div>
<div class="listingblock">
<div class="content">
<pre># python 3.6

import random
import time

from paho.mqtt import client as mqtt_client

#broker = 'broker.emqx.io'
broker = '192.168.122.254'
port = 1883
topic = "python/mqtt"
# Generate a Client ID with the publish prefix.
client_id = f'publish-{random.randint(0, 1000)}'
# username = 'emqx'
# password = 'public'

def connect_mqtt():
    def on_connect(client, userdata, flags, rc):
        if rc == 0:
            print("Connected to MQTT Broker!")
        else:
            print("Failed to connect, return code %d\n", rc)

    client = mqtt_client.Client(client_id)
    # client.username_pw_set(username, password)
    client.on_connect = on_connect
    client.connect(broker, port)
    return client


def publish(client):
    msg_count = 1
    while True:
        time.sleep(1)
        msg = f"messages: {msg_count}"
        result = client.publish(topic, msg)
        # result: [0, 1]
        status = result[0]
        if status == 0:
            print(f"Send `{msg}` to topic `{topic}`")
        else:
            print(f"Failed to send message to topic {topic}")
        msg_count += 1
        if msg_count &gt; 5:
            break


def run():
    client = connect_mqtt()
    client.loop_start()
    publish(client)
    client.loop_stop()


if __name__ == '__main__':
    run()</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshoot">17. troubleshoot</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_troubleshoot_2">17.1. troubleshoot</h3>
<div class="paragraph">
<p>Q1:Failed to find catalog entry: Invalid argument</p>
</div>
<div class="listingblock">
<div class="title">A1:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">journalctl --update-catalog</code></pre>
</div>
</div>
<div class="paragraph">
<p>Q2:MongoDB loads but breaks, returning status=14</p>
</div>
<div class="listingblock">
<div class="title">A2:也许不在此路径，先查看是否存在该文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf /tmp/mongodb-27017.sock</code></pre>
</div>
</div>
<div class="paragraph">
<p>Q3:arch linux 没有声音</p>
</div>
<div class="listingblock">
<div class="title">A3:安装音频驱动包</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo pacman -S sof-firmware
sudo pacman -S alsa-ucm-conf
reboot</code></pre>
</div>
</div>
<div class="paragraph">
<p>Q4:error: Refusing to undefine while domain managed save image exists</p>
</div>
<div class="paragraph">
<p>Q4:错误： 域管理的保存映像存在时拒绝取消定义</p>
</div>
<div class="listingblock">
<div class="title">A4:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virsh managedsave-remove win7</code></pre>
</div>
</div>
<div class="paragraph">
<p>Q:Failed to start OpenSSH Daemon</p>
</div>
<div class="listingblock">
<div class="title">A4:检查配置文件帮助排错</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sshd -t</code></pre>
</div>
</div>
<div class="paragraph">
<p>Q5:jdk-openjdk and jre-openjdk are in conflict</p>
</div>
<div class="listingblock">
<div class="title">A5:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo pacman -Sy jre-openjdk</code></pre>
</div>
</div>
<div class="paragraph">
<p>Q6:vmware 看不到共享文件夹</p>
</div>
<div class="listingblock">
<div class="title">A6:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vmhgfs-fuse /mnt/hgfs</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mysql主从">18. mysql主从</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">主：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql
mysql&gt;SET GLOBAL server_id = 1;
mysql&gt;SET GLOBAL validate_password.policy = 0;
mysql&gt; CREATE USER 'repl'@'%' IDENTIFIED BY '@#$Rfg345634523rft4fa';
mysql&gt; GRANT REPLICATION SLAVE ON *.* TO 'repl'@'%';
mysql&gt; FLUSH TABLES WITH READ LOCK;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
执行 <code>FLUSH TABLES WITH READ LOCK</code> 之后不要退出客户端。再开另一个终端到主：
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">主：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql
mysql&gt; SHOW MASTER STATUS\G</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre>*************************** 1. row ***************************
             File: mysql-bin.000002
         Position: 690
     Binlog_Do_DB:
 Binlog_Ignore_DB:
Executed_Gtid_Set:
1 row in set (0.00 sec)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
注意记录输出信息中的File和Position
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">从：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo 'server-id=2' &gt;&gt; /etc/my.cnf
mysql
mysql&gt;SET GLOBAL server_id = 2;
mysql&gt; CHANGE REPLICATION SOURCE TO
        SOURCE_HOST='192.168.122.254',
        SOURCE_USER='repl',
        SOURCE_PASSWORD='@#$Rfg345634523rft4fa',
        SOURCE_LOG_FILE='mysql-bin.000007',
        SOURCE_LOG_POS=597;</code></pre>
</div>
</div>
<div class="paragraph">
<p>回到</p>
</div>
<div class="listingblock">
<div class="title">主：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql&gt; UNLOCK TABLES;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">从：</div>
<p>在从mysql中查看主从同步状态：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mysql&gt; show slave status \G;</code></pre>
</div>
</div>
<div class="paragraph">
<p>输出</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*************************** 1. row ***************************
               Slave_IO_State:
                  Master_Host: master
                  Master_User: repl
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000002
          Read_Master_Log_Pos: 690
               Relay_Log_File: slave-relay-bin.000001
                Relay_Log_Pos: 4
        Relay_Master_Log_File: mysql-bin.000002
             Slave_IO_Running: No
            Slave_SQL_Running: No
              Replicate_Do_DB:
              ...
              ...
       Master_public_key_path:
        Get_master_public_key: 0
            Network_Namespace:
1 row in set, 1 warning (0.00 sec)

ERROR:
No query specified</pre>
</div>
</div>
<div class="paragraph">
<p>此时的SlaveIORunning 和 SlaveSQLRunning 都是No，因为我们还没有开启主从复制过程。
开启主从复制：</p>
</div>
<div class="listingblock">
<div class="title">从：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">start slave;</code></pre>
</div>
</div>
<div class="paragraph">
<p>再次查看同步状态：</p>
</div>
<div class="listingblock">
<div class="title">从：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">show slave status \G;</code></pre>
</div>
</div>
<div class="paragraph">
<p>SlaveIORunning 和 SlaveSQLRunning 都是Yes说明主从复制已经开启。</p>
</div>
<div class="paragraph">
<p>regerence:
<a href="https://dev.mysql.com/doc/refman/8.0/en/replication.html" class="bare">https://dev.mysql.com/doc/refman/8.0/en/replication.html</a>
<a href="https://juejin.cn/post/6844903921677238285" class="bare">https://juejin.cn/post/6844903921677238285</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_pypi">19. pypi</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_打包成可执行文件">19.1. 打包成可执行文件</h3>
<div class="listingblock">
<div class="title">文件结构</div>
<div class="content">
<pre>mongo-py
├── common.py
├── file.json
├── main.py
├── mongo_tool
│   ├── delete.py
│   ├── insert.py
│   ├── query.py
│   └── update.py
├── pyproject.toml
├── README.md</pre>
</div>
</div>
<div class="listingblock">
<div class="title">pyproject.toml</div>
<div class="content">
<pre>[tool.poetry]
name = "czh-mongo-py"
version = "0.0.1.0"
description = ""
authors = ["xiangyouzhuan &lt;xiangyouzhuan2018@gmail.com&gt;"]
readme = "README.md"

packages = [
    { include = "common.py" },  #包含所需的文件
    { include = "main.py" },
    { include = "mongo_tool" }
]

[tool.poetry.dependencies]
python = "&gt;=3.8.5 &lt;4.0.0"

[tool.poetry.scripts]
czhmongopy = "main:main"  #此处‘czhmongopy’是使用软件时的命令，等同于python main.py
                          #"main:main"指main.py下的main()函数

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd mongo-py
poetry build -f wheel</code></pre>
</div>
</div>
<div class="paragraph">
<p>本地安装测试</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install -U --user dist/xxxxx.whl</code></pre>
</div>
</div>
<div class="paragraph">
<p>列出 Python 包文件列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip show czh-mongo-py -f</code></pre>
</div>
</div>
<div class="paragraph">
<p>获取命令行工具执行路径：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python -c "import site; print('%s/bin/czhmongopy' % site.USER_BASE)"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>~/.local/bin/czhmongopy</pre>
</div>
</div>
<div class="paragraph">
<p>运行</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">~/.local/bin/czhmongopy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>命令行参数错误，请查看使用说明
usage: mongo_tool [-i file] [-d filter] [-u filter json] [-q filter]

mongo工具

options:
  -h, --help            show this help message and exit
  -i file, --insert file
                        将js文件内容写入数据库
  -u filter json, --update filter json
                        更改满足filter的数据
  -q filter, --query filter
                        查询满足filter的数据
  -d filter, --delete filter
                        删除所有满足条件的document
  -v, --version         显示版本信息</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">reference</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://packaging.python.org/en/latest/tutorials/packaging-projects/" class="bare">https://packaging.python.org/en/latest/tutorials/packaging-projects/</a></p>
</li>
<li>
<p><a href="https://github.com/geekcampchina/geekcamp-calculator" class="bare">https://github.com/geekcampchina/geekcamp-calculator</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_上传到pypi">19.2. 上传到pypi</h3>
<div class="listingblock">
<div class="title">上传到testpypi</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">twine upload --repository testpypi dist/*</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">上传到pypi</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">twine upload dist/*</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">终端提醒输入username 和 password时：</div>
<ul>
<li>
<p>username输入 <code>__token__</code></p>
</li>
<li>
<p>password输入token(token需要在pypi生成)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>Uploading distributions to https://test.pypi.org/legacy/
Enter your username: __token__
Uploading czh-mongo-py-0.0.1-py3-none-any.whl
100% ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 8.2/8.2 kB • 00:01 • ?
Uploading czh-mongo-py-0.0.1.tar.gz
100% ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.8/6.8 kB • 00:00 • ?</pre>
</div>
</div>
<div class="paragraph">
<p>测试从testpypi安装czh-mongo-py</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install --index-url https://test.pypi.org/simple/ --no-deps czh-mongo-py</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置连接数据库的环境变量</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export mongoship=192.168.122.52
export mongoshport=27017</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输入命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">czhmongpy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>命令行参数错误，请查看使用说明
usage: mongo_tool [-i file] [-d filter] [-u filter json] [-q filter]

mongo工具

options:
  -h, --help            show this help message and exit
  -i file, --insert file
                        将js文件内容写入数据库
  -u filter json, --update filter json
                        更改满足filter的数据
  -q filter, --query filter
                        查询满足filter的数据
  -d filter, --delete filter
                        删除所有满足条件的document
  -v, --version         显示版本信息</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kafka">20. kafka</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_quickstart">20.1. quickstart</h3>
<div class="sect3">
<h4 id="_环境准备_2">20.1.1. 环境准备</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
本地环境必须安装Java 8+
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">安装java17</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@dlp ~]# dnf -y install java-17-openjdk java-17-openjdk-devel

[root@dlp ~]# cat &gt; /etc/profile.d/java.sh &lt;&lt;'EOF'
export JAVA_HOME=$(dirname $(dirname $(readlink $(readlink $(which java)))))
export PATH=$PATH:$JAVA_HOME/bin
EOF

[root@dlp ~]# source /etc/profile.d/java.sh

[root@dlp ~]# java --version
openjdk 17.0.3 2022-04-19 LTS
OpenJDK Runtime Environment 21.9 (build 17.0.3+7-LTS)
OpenJDK 64-Bit Server VM 21.9 (build 17.0.3+7-LTS, mixed mode, sharing)

# verify to create test program
[root@dlp ~]# cat &gt; java_test.java &lt;&lt;'EOF'
class java_test {
    public static void main(String[] args) {
        System.out.println("Hello Java World !");
    }
}
EOF

[root@dlp ~]# javac java_test.java
[root@dlp ~]# java java_test
Hello Java World !</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您从CentOS官方存储库安装了多个版本的Java，则可以使用 <code>alternatives</code> 来切换它们。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@dlp ~]# alternatives --config java

There are 3 programs which provide 'java'.

  Selection    Command
-----------------------------------------------
   1           java-1.8.0-openjdk.x86_64 (/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.332.b09-1.el9.x86_64/jre/bin/java)
*+ 2           java-11-openjdk.x86_64 (/usr/lib/jvm/java-11-openjdk-11.0.15.0.10-1.el9.x86_64/bin/java)
   3           java-17-openjdk.x86_64 (/usr/lib/jvm/java-17-openjdk-17.0.3.0.7-1.el9.x86_64/bin/java)

Enter to keep the current selection[+], or type selection number: 3

[root@dlp ~]# alternatives --config javac

There are 3 programs which provide 'javac'.

  Selection    Command
-----------------------------------------------
   1           java-1.8.0-openjdk.x86_64 (/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.332.b09-1.el9.x86_64/bin/javac)
*+ 2           java-11-openjdk.x86_64 (/usr/lib/jvm/java-11-openjdk-11.0.15.0.10-1.el9.x86_64/bin/javac)
   3           java-17-openjdk.x86_64 (/usr/lib/jvm/java-17-openjdk-17.0.3.0.7-1.el9.x86_64/bin/javac)

Enter to keep the current selection[+], or type selection number: 3

[root@dlp ~]# java --version
openjdk 17.0.3 2022-04-19 LTS
OpenJDK Runtime Environment 21.9 (build 17.0.3+7-LTS)
OpenJDK 64-Bit Server VM 21.9 (build 17.0.3+7-LTS, mixed mode, sharing)
[root@dlp ~]# javac --version
javac 17.0.3</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_1_下载kafka">20.1.2. 1.下载KAFKA</h4>
<div class="paragraph">
<p>下载新的KAFKA发行版并解压</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">wget https://dlcdn.apache.org/kafka/3.5.0/kafka_2.13-3.5.0.tgz
tar xf kafka_2.13-3.5.0.tgz
cd kafka_2.13-3.5.0</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_2_启动kafka环境">20.1.3. 2.启动KAFKA环境</h4>
<div class="paragraph">
<p>为了使zookeeper和Kafka broker服务管理更方便，将它们添加至系统服务</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt; /etc/systemd/system/zookeeper.service
[Unit]
Description=ZooKeeper Server
After=network.target
before=kafka.service

[Service]
User=root
ExecStart=/root/kafka_2.13-3.5.0/bin/zookeeper-server-start.sh /root/kafka_2.13-3.5.0/config/zookeeper.properties
WorkingDirectory=/root/kafka_2.13-3.5.0

[Install]
WantedBy=multi-user.target
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt; /etc/systemd/system/kafka.service
[Unit]
Description=Kafka Server
After=network.target zookeeper.service

[Service]
User=root
ExecStart=/root/kafka_2.13-3.5.0/bin/kafka-server-start.sh /root/kafka_2.13-3.5.0/config/server.properties
WorkingDirectory=/root/kafka_2.13-3.5.0

[Install]
WantedBy=multi-user.target
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动ZooKeeper服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#设置开机自启动
systemctl enable zookeeper
#启动ZooKeeper服务
systemctl start zookeeper
#查看ZooKeeper服务
systemctl status zookeeper</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动Kafka broker服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#设置开机自启动
systemctl enable kafka
#启动kafka服务
systemctl start kafka
#查看kafka服务
systemctl status kafka</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_3_创建一个topic用来存储事件">20.1.4. 3.创建一个topic用来存储事件</h4>
<div class="paragraph">
<p>在写第一个事件之前，必须创建一个topic。</p>
</div>
<div class="paragraph">
<p>打开另一个终端</p>
</div>
<div class="listingblock">
<div class="title">创建一个topic</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-topics.sh --create --topic quickstart-events --bootstrap-server localhost:9092</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_4_往该topic中写入事件">20.1.5. 4.往该topic中写入事件</h4>
<div class="listingblock">
<div class="title">使用producer</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-console-producer.sh --topic quickstart-events --bootstrap-server localhost:9092
This is my first event
This is my second event</code></pre>
</div>
</div>
<div class="paragraph">
<p>你可以在任何时候使用 <code>Ctrl-C</code> 关闭producer客户端</p>
</div>
</div>
<div class="sect3">
<h4 id="_5_读事件">20.1.6. 5.读事件</h4>
<div class="listingblock">
<div class="title">再开一个终端，执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server localhost:9092
This is my first event
This is my second event</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>Ctrl-C</code> 可终止程序</p>
</div>
</div>
<div class="sect3">
<h4 id="_6_用kafka_connnect将数据导入导出成事件流">20.1.7. 6.用KAFKA CONNNECT将数据导入/导出成事件流</h4>
<div class="paragraph">
<p>Kafka Connect允许你不断地从外部系统摄取数据到Kafka
在这个快速入门中，我们将看到如何使用简单的连接器来运行Kafka Connect，将数据从文件导入到Kafka topic，并将数据从Kafka topic导出到文件。</p>
</div>
<div class="listingblock">
<div class="title">在文件config/connect-standalone.properties中添加配置属性</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo "plugin.path=libs/connect-file-3.5.0.jar"&gt;&gt;config/connect-standalone.properties</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">添加测试的数据</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo -e "foo\nbar" &gt; test.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动以独立模式运行的两个连接器</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/connect-standalone.sh config/connect-standalone.properties config/connect-file-source.properties config/connect-file-sink.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>新开一个终端</p>
</div>
<div class="listingblock">
<div class="title">查看test.sink.txt文件内容</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">more test.sink.txt
foo
bar</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
数据被存储在Kafka的topic：connect-test中，所以我们也可以运行一个console-consumer来查看主题中的数据(或者使用自定义consumer代码来处理它):
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">运行console-consumer查看connect-test中数据</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic connect-test --from-beginning
{"schema":{"type":"string","optional":false},"payload":"foo"}
{"schema":{"type":"string","optional":false},"payload":"bar"}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>此时connector继续处理数据，因此我们可以将数据添加到文件中，并看到它在管道中移动:</p>
</div>
<div class="paragraph">
<p>打开一个新终端</p>
</div>
<div class="listingblock">
<div class="title">添加数据到文件中</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo Another line &gt;&gt; test.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在你应该看到这一行出现在console consumer 的输出和test.sink.txt文件中。</p>
</div>
</div>
<div class="sect3">
<h4 id="_常用命令">20.1.8. 常用命令</h4>
<div class="listingblock">
<div class="title">增加kafka topic quickstart-events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-topics.sh --create --topic quickstart-events --bootstrap-server localhost:9092</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">kafka命令行发消息：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-console-producer.sh --topic quickstart-events --bootstrap-server localhost:9092
This is my first event
This is my second event</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">kafka命令行收消息：</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-console-consumer.sh --topic quickstart-events --from-beginning --bootstrap-server localhost:9092</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">删除kafka topic quickstart-events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-topics.sh --delete --topic quickstart-events --bootstrap-server localhost:9092</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看kafka quickstart-events详情</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-topics.sh --describe --topic quickstart-events --bootstrap-server localhost:9092</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看kafka topic列表</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-topics.sh --list --bootstrap-server localhost:9092</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看topic中数据</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic connect-test --from-beginning</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kafka_java_demo">20.2. kafka java demo</h3>
<div class="paragraph">
<p>将项目打包成jar
sudo mvn clean compile assembly:single
cd target
java -jar xxxxx.jar</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rabbitmq">21. RabbitMQ</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_rabbitmq安装">21.1. RabbitMQ安装</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">官方文档</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.rabbitmq.com/install-rpm.html#cloudsmith" class="bare">https://www.rabbitmq.com/install-rpm.html#cloudsmith</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>安装RabbitMQ和Cloudsmith签名密钥</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">## primary RabbitMQ signing key
rpm --import 'https://github.com/rabbitmq/signing-keys/releases/download/3.0/rabbitmq-release-signing-key.asc'
## modern Erlang repository
rpm --import 'https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key'
## RabbitMQ server repository
rpm --import 'https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-server.9F4587F226208342.key'</code></pre>
</div>
</div>
<div class="paragraph">
<p>将以下内容写入文件 <code>/etc/yum.repos.d/rabbitmq.repo</code> 中</p>
</div>
<div class="listingblock">
<div class="title">添加RabbitMQ仓库</div>
<div class="content">
<pre>cat &lt;&lt;EOF &gt;/etc/yum.repos.d/rabbitmq.repo
# In /etc/yum.repos.d/rabbitmq.repo

##
## Zero dependency Erlang RPM
##

[modern-erlang]
name=modern-erlang-el9
# uses a Cloudsmith mirror @ yum.novemberain.com.
# Unlike Cloudsmith, it does not have any traffic quotas
baseurl=https://yum1.novemberain.com/erlang/el/9/$basearch
        https://yum2.novemberain.com/erlang/el/9/$basearch
        https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/rpm/el/9/$basearch
repo_gpgcheck=1
enabled=1
gpgkey=https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key
gpgcheck=1
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
pkg_gpgcheck=1
autorefresh=1
type=rpm-md

[modern-erlang-noarch]
name=modern-erlang-el9-noarch
# uses a Cloudsmith mirror @ yum.novemberain.com.
# Unlike Cloudsmith, it does not have any traffic quotas
baseurl=https://yum1.novemberain.com/erlang/el/9/noarch
        https://yum2.novemberain.com/erlang/el/9/noarch
        https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/rpm/el/9/noarch
repo_gpgcheck=1
enabled=1
gpgkey=https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key
       https://github.com/rabbitmq/signing-keys/releases/download/3.0/rabbitmq-release-signing-key.asc
gpgcheck=1
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
pkg_gpgcheck=1
autorefresh=1
type=rpm-md

[modern-erlang-source]
name=modern-erlang-el9-source
# uses a Cloudsmith mirror @ yum.novemberain.com.
# Unlike Cloudsmith, it does not have any traffic quotas
baseurl=https://yum1.novemberain.com/erlang/el/9/SRPMS
        https://yum2.novemberain.com/erlang/el/9/SRPMS
        https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-erlang/rpm/el/9/SRPMS
repo_gpgcheck=1
enabled=1
gpgkey=https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-erlang.E495BB49CC4BBE5B.key
       https://github.com/rabbitmq/signing-keys/releases/download/3.0/rabbitmq-release-signing-key.asc
gpgcheck=1
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
pkg_gpgcheck=1
autorefresh=1


##
## RabbitMQ Server
##

[rabbitmq-el9]
name=rabbitmq-el9
baseurl=https://yum2.novemberain.com/rabbitmq/el/9/$basearch
        https://yum1.novemberain.com/rabbitmq/el/9/$basearch
        https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/rpm/el/9/$basearch
repo_gpgcheck=1
enabled=1
# Cloudsmith's repository key and RabbitMQ package signing key
gpgkey=https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-server.9F4587F226208342.key
       https://github.com/rabbitmq/signing-keys/releases/download/3.0/rabbitmq-release-signing-key.asc
gpgcheck=1
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
pkg_gpgcheck=1
autorefresh=1
type=rpm-md

[rabbitmq-el9-noarch]
name=rabbitmq-el9-noarch
baseurl=https://yum2.novemberain.com/rabbitmq/el/9/noarch
        https://yum1.novemberain.com/rabbitmq/el/9/noarch
        https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/rpm/el/9/noarch
repo_gpgcheck=1
enabled=1
# Cloudsmith's repository key and RabbitMQ package signing key
gpgkey=https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-server.9F4587F226208342.key
       https://github.com/rabbitmq/signing-keys/releases/download/3.0/rabbitmq-release-signing-key.asc
gpgcheck=1
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
pkg_gpgcheck=1
autorefresh=1
type=rpm-md

[rabbitmq-el9-source]
name=rabbitmq-el9-source
baseurl=https://yum2.novemberain.com/rabbitmq/el/9/SRPMS
        https://yum1.novemberain.com/rabbitmq/el/9/SRPMS
        https://dl.cloudsmith.io/public/rabbitmq/rabbitmq-server/rpm/el/9/SRPMS
repo_gpgcheck=1
enabled=1
gpgkey=https://github.com/rabbitmq/signing-keys/releases/download/3.0/cloudsmith.rabbitmq-server.9F4587F226208342.key
gpgcheck=0
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
pkg_gpgcheck=1
autorefresh=1
type=rpm-md
EOF</pre>
</div>
</div>
<div class="listingblock">
<div class="title">更新软件包的元数据信息</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dnf update -y</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">从标准软件仓库中安装依赖项</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dnf install -y socat logrotate</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装 Erlang 和 RabbitMQ</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">dnf install -y erlang rabbitmq-server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">设置开机自启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl enable rabbitmq-server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动rabbitmq-server</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl start rabbitmq-server</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">查看rabbitmq-server状态</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl status  rabbitmq-server</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rabbitmq_配置">21.2. RabbitMQ 配置</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">官方文档</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.rabbitmq.com/install-rpm.html#cloudsmith" class="bare">https://www.rabbitmq.com/install-rpm.html#cloudsmith</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">配置RabbitMQ</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#添加用户并设置密码
rabbitmqctl add_user 'myuser' '2a55f70a841f18b97c3a7db939b7adc9e34a0f1b'

#列出所有的用户
rabbitmqctl list_users

#添加虚拟主机qa1
rabbitmqctl add_vhost qa1

#向用户授权
#第一个 .* 表示对于每个实体，都授予配置权限。
#第二个 .* 表示对于每个实体，都授予写入权限。
#第三个 .* 表示对于每个实体，都授予读取权限。
rabbitmqctl set_permissions -p "qa1" "myuser" ".*" ".*" ".*"

#设置系统最大文件句柄
echo "*               soft   nofile            65535" &gt;&gt; /etc/security/limits.conf
echo "*               hard   nofile            65535" &gt;&gt; /etc/security/limits.conf

#重启生效
reboot

#查看文件句柄最大值
ulimit -n

#设置RabbitMQ最大文件句柄
sed -i "s|# LimitNOFILE=65536|LimitNOFILE=65536|" /usr/lib/systemd/system/rabbitmq-server.service
sed -i "s|LimitNOFILE=32768|#LimitNOFILE=32768|" /usr/lib/systemd/system/rabbitmq-server.service

#重启服务
systemctl daemon-reload
systemctl restart rabbitmq-server</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rabbimq使用">21.3. RabbiMQ使用</h3>
<div class="sect3">
<h4 id="_rabbitmq_cli">21.3.1. RabbitMQ cli</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rabbitmq-plugins enable rabbitmq_management
RABBITMQ_ADMIN=`find / -name rabbitmqadmin`
cp $RABBITMQ_ADMIN /usr/bin/
chmod +x /usr/bin/rabbitmqadmin

#定义一个队列queue，durable=true代表持久化打开。
rabbitmqadmin declare queue name=test durable=true

#定义一个Topic路由
rabbitmqadmin declare exchange name=my.topic type=topic

#发布一条消息
rabbitmqadmin publish routing_key=test payload="hello world"

#使用路由转发消息
rabbitmqadmin publish routing_key=my.test exchange=my.topic payload="hello world"

#查看消息
rabbitmqadmin get queue=test</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_python_2">21.3.2. python</h4>
<div class="listingblock">
<div class="title">环境准备</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip3 install pika</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">receive.py脚本文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; receive.py
import pika

credentials = pika.PlainCredentials('myuser','2a55f70a841f18b97c3a7db939b7adc9e34a0f1b')
connection = pika.BlockingConnection(pika.ConnectionParameters(
    'localhost',5672,'qa1',credentials))
channel = connection.channel()

channel.queue_declare(queue='balance')


def callback(ch, method, properties, body):
    print(" [x] Received %r" % body)

channel.basic_consume(queue='balance',
                      auto_ack=False,
                      on_message_callback=callback)

print(' [*] Waiting for messages. To exit press CTRL+C')
channel.start_consuming()

EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">send.py脚本文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; send.py
#!/usr/bin/env python
import pika

auth = pika.PlainCredentials("myuser","2a55f70a841f18b97c3a7db939b7adc9e34a0f1b")
connect = pika.BlockingConnection(pika.ConnectionParameters("localhost", port=5672, virtual_host='qa1', credentials=auth))
channel = connect.channel()

channel.queue_declare(queue='balance')
channel.basic_publish(exchange='',
                      routing_key='balance',
                      body='Hello World!')
print(" [x] Sent 'Hello World!'")
connect.close()
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">执行receive.py</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python3 receive.py</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>[*] Waiting for messages. To exit press CTRL+C</pre>
</div>
</div>
<div class="paragraph">
<p>打开另一个终端</p>
</div>
<div class="listingblock">
<div class="title">执行send.py</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">python3 send.py</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre> [x] Sent 'Hello World!'</pre>
</div>
</div>
<div class="paragraph">
<p>回到执行receive.py的终端，可看到</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[*] Waiting for messages. To exit press CTRL+C
[x] Received b'Hello World!'</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_yum换源">22. yum换源</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_yum_换源">22.1. yum 换源</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mv /etc/yum.repos.d/centos.repo /etc/yum.repos.d/centos.repo.backup
touch /etc/yum.repos.d/centos.repo</code></pre>
</div>
</div>
<div class="paragraph">
<p>将以下内容写入centos.repo中</p>
</div>
<div class="listingblock">
<div class="content">
<pre># CentOS-Base.repo
#
# The mirror system uses the connecting IP address of the client and the
# update status of each mirror to pick mirrors that are updated to and
# geographically close to the client.  You should use this for CentOS updates
# unless you are manually picking other mirrors.
#
# If the mirrorlist= does not work for you, as a fall back you can try the
# remarked out baseurl= line instead.
#
#

[base]
name=CentOS-$releasever - Base - mirrors.aliyun.com
#failovermethod=priority
baseurl=https://mirrors.aliyun.com/centos-stream/$stream/BaseOS/$basearch/os/
        http://mirrors.aliyuncs.com/centos-stream/$stream/BaseOS/$basearch/os/
        http://mirrors.cloud.aliyuncs.com/centos-stream/$stream/BaseOS/$basearch/os/
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/centos-stream/RPM-GPG-KEY-CentOS-Official

#additional packages that may be useful
#[extras]
#name=CentOS-$releasever - Extras - mirrors.aliyun.com
#failovermethod=priority
#baseurl=https://mirrors.aliyun.com/centos-stream/$stream/extras/$basearch/os/
#        http://mirrors.aliyuncs.com/centos-stream/$stream/extras/$basearch/os/
#        http://mirrors.cloud.aliyuncs.com/centos-stream/$stream/extras/$basearch/os/
#gpgcheck=1
#gpgkey=https://mirrors.aliyun.com/centos-stream/RPM-GPG-KEY-CentOS-Official

#additional packages that extend functionality of existing packages
[centosplus]
name=CentOS-$releasever - Plus - mirrors.aliyun.com
#failovermethod=priority
baseurl=https://mirrors.aliyun.com/centos-stream/$stream/centosplus/$basearch/os/
        http://mirrors.aliyuncs.com/centos-stream/$stream/centosplus/$basearch/os/
        http://mirrors.cloud.aliyuncs.com/centos-stream/$stream/centosplus/$basearch/os/
gpgcheck=1
enabled=0
gpgkey=https://mirrors.aliyun.com/centos-stream/RPM-GPG-KEY-CentOS-Official

[PowerTools]
name=CentOS-$releasever - PowerTools - mirrors.aliyun.com
#failovermethod=priority
baseurl=https://mirrors.aliyun.com/centos-stream/$stream/PowerTools/$basearch/os/
        http://mirrors.aliyuncs.com/centos-stream/$stream/PowerTools/$basearch/os/
        http://mirrors.cloud.aliyuncs.com/centos-stream/$stream/PowerTools/$basearch/os/
gpgcheck=1
enabled=0
gpgkey=https://mirrors.aliyun.com/centos-stream/RPM-GPG-KEY-CentOS-Official


[AppStream]
name=CentOS-$releasever - AppStream - mirrors.aliyun.com
#failovermethod=priority
baseurl=https://mirrors.aliyun.com/centos-stream/$stream/AppStream/$basearch/os/
        http://mirrors.aliyuncs.com/centos-stream/$stream/AppStream/$basearch/os/
        http://mirrors.cloud.aliyuncs.com/centos-stream/$stream/AppStream/$basearch/os/
gpgcheck=1
gpgkey=https://mirrors.aliyun.com/centos-stream/RPM-GPG-KEY-CentOS-Official</pre>
</div>
</div>
<div class="paragraph">
<p>更新缓存</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum makecache &amp;&amp; yum update</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_yum常用命令">22.2. yum常用命令</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#通过命令查找该命令由什么软件提供
yum whatprovides 命令</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proxychains">23. Proxychains</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装配置">23.1. 安装配置</h3>
<div class="listingblock">
<div class="title">安装配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y epel-release
yum install -y proxychains-ng.x86_64

sed -E -i 's/socks4\s+127.0.0.1 9050/socks5 192.168.2.8 1080/' /etc/proxychains.conf
sed -i 's/#quiet_mode/quiet_mode/g' /etc/proxychains.conf

echo 'alias p="/usr/bin/proxychains4"' &gt;&gt; ~/.bashrc
# 不重启终端生效环境配置
source ~/.bashrc

# 测试访问
p curl -I www.youtube.com</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_drupal环境搭建">24. Drupal环境搭建</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Nginx_install_chapter">24.1. 配置内网环境一：安装Nginx</h3>
<div class="listingblock">
<div class="title">安装Nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y nginx</code></pre>
</div>
</div>
<div class="paragraph">
<p>修改nginx配置文件</p>
</div>
<div class="listingblock">
<div class="title">1.修改Nginx主配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; /etc/nginx/nginx.conf
# For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

user nginx;
worker_processes auto;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

worker_rlimit_nofile 65535;

events {
    worker_connections 65535;
}

http {
    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    log_format  main  '\$host \$server_port \$remote_addr - \$remote_user [\$time_local] "\$request" '
                      '\$status \$request_time \$body_bytes_sent "\$http_referer" '
                      '"\$http_user_agent" "\$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    server_names_hash_bucket_size 128;
    server_name_in_redirect off;
    client_header_buffer_size 32k;
    large_client_header_buffers 4 32k;

    client_header_timeout  3m;
    client_body_timeout    3m;
    client_max_body_size 50m;
    client_body_buffer_size 256k;
    send_timeout           3m;

    gzip  on;
    gzip_min_length  1k;
    gzip_buffers     4 16k;
    gzip_http_version 1.0;
    gzip_comp_level 2;
    gzip_types image/svg+xml application/x-font-wof text/plain text/xml text/css application/xml application/xhtml+xml application/rss+xml application/javascript application/x-javascript text/javascript;
    gzip_vary on;

    proxy_redirect off;
    proxy_set_header Host \$host;
    proxy_set_header X-Real-IP \$remote_addr;
    proxy_set_header REMOTE-HOST \$remote_addr;
    proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
    proxy_connect_timeout 60;
    proxy_send_timeout 60;
    proxy_read_timeout 60;
    proxy_buffer_size 256k;
    proxy_buffers 4 256k;
    proxy_busy_buffers_size 256k;
    proxy_temp_file_write_size 256k;
    proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;
    proxy_max_temp_file_size 128m;
    #让代理服务端不要主动关闭客户端的连接，协助处理499返回代码问题
    proxy_ignore_client_abort on;

    fastcgi_buffer_size 64k;
    fastcgi_buffers 4 64k;
    fastcgi_busy_buffers_size 128k;

    index index.html index.htm index.php default.html default.htm default.php;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;
}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">2.增加默认 Host</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /etc/nginx/conf.d

test -f /etc/nginx/conf.d/default.conf &amp;&amp; (test -f /etc/nginx/conf.d/default.conf.init || cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.init)

cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/default.conf
server {
    listen       80 default_server;
    listen       [::]:80 default_server;
    server_name  _;
    root         /usr/share/nginx/html;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }
}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">3.测试Nginx配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nginx -t &amp;&amp; (test -s /var/run/nginx.pid || rm -f /var/run/nginx.pid)</code></pre>
</div>
</div>
<div class="paragraph">
<p>启动Nginx</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">开机启动
systemctl enable nginx
systemctl start nginx
systemctl status nginx</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>● nginx.service - nginx - high performance web server
   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)
   Active: active (running) since Thu 2023-01-19 00:00:23 CST; 3s ago
     Docs: http://nginx.org/en/docs/
  Process: 9617 ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)
 Main PID: 9618 (nginx)
   CGroup: /system.slice/nginx.service
           ├─9618 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf
           ├─9619 nginx: worker process
           ├─9620 nginx: worker process
           ├─9621 nginx: worker process
           └─9622 nginx: worker process

Jan 19 00:00:23 lan_server systemd[1]: Starting nginx - high performance web server...
Jan 19 00:00:23 lan_server systemd[1]: Started nginx - high performance web server.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="PHP_install_chapter">24.2. 配置内网环境二：安装PHP</h3>
<div class="listingblock">
<div class="title">安装Nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y  php php-bcmath php-fpm php-gd php-intl php-mbstring php-mysqlnd php-opcache php-pdo php-pecl-apcu     php-devel</code></pre>
</div>
</div>
<div class="paragraph">
<p>当完成环境配置后，可以通过以下验证 LNMP 环境是否搭建成功
执行以下命令，创建测试文件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">echo "&lt;?php phpinfo(); ?&gt;" &gt;&gt; /usr/share/nginx/html/index.php

#重启 Nginx 服务
systemctl restart nginx</code></pre>
</div>
</div>
<div class="paragraph">
<p>在本地浏览器中访问如下地址，查看环境配置是否成功。</p>
</div>
<div class="paragraph">
<p><a href="http://云服务器实例的公网IP/index.php" class="bare">http://云服务器实例的公网IP/index.php</a></p>
</div>
<div class="paragraph">
<p>显示结果如下，则说明环境配置成功。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/php_install_01.png" alt="php install 01">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_配置内网环境三lnmp环境测试">24.3. 配置内网环境三：LNMP环境测试</h3>
<div class="listingblock">
<div class="title">增加Nginx Host设置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/test.drupal.com.conf
server {
    listen       80;

    server_name  test.drupal.com;
    root         /data/web/test.drupal.com;
    error_log /var/log/nginx/test.drupal.com_error.log;
    access_log /var/log/nginx/test.drupal.com_access.log  main;

    location / {
        try_files \$uri /index.php\$is_args\$query_string;
    }

    location ~ \.php\$ {
        try_files \$uri \$uri/ 404;

        fastcgi_pass unix:/run/php-fpm/www.sock;
        fastcgi_param SCRIPT_FILENAME \$document_root\$fastcgi_script_name;
        include fastcgi_params;
    }
}
EOF

nginx -t &amp;&amp; nginx -s reload</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful</pre>
</div>
</div>
<div class="listingblock">
<div class="title">准备Drupal</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /data/web/test.drupal.com

# 使用 -O 参数指定保存文件名，会强制覆盖已经存在的文件
wget https://ftp.drupal.org/files/projects/drupal-9.5.11.tar.gz -O drupal-9.5.11.tar.gz
tar xf drupal-9.5.11.tar.gz

mv drupal-9.5.11/* /data/web/test.drupal.com
rm -rf drupal-9.5.11
chown -R apache:nginx /data/web/test.drupal.com
chmod -R 755 /data/web/test.drupal.com

echo '127.0.0.1 test.drupal.com' &gt;&gt; /etc/hosts
最后，访问 http://test.drupal.com 完成安装。</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hadoop">25. hadoop</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_环境准备_3">25.1. 环境准备</h3>
<div class="ulist">
<ul>
<li>
<p>centos-stream-9</p>
</li>
<li>
<p>java11</p>
</li>
<li>
<p>hadoop-3.3.6</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>准备三台服务器bigdata1 bigdata2 bigdata3</p>
</div>
<div class="listingblock">
<div class="title">在这三台服务器上均执行以下内容</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl stop firewalld.service
systemctl disable firewalld.service

cat &lt;&lt; EOF &gt;&gt; /etc/hosts
192.168.122.25 bigdata1
192.168.122.146 bigdata2
192.168.122.219 bigdata3
EOF

yum update -y
yum install -y java-11-openjdk java-11-openjdk-devel
yum install -y rsync

cat &lt;&lt; EOF &gt;&gt; ~/.bashrc
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.18.0.10-3.el9.x86_64
export PATH=$PATH:$JAVA_HOME/bin
export HADOOP_HOME=/opt/module/hadoop-3.3.6
export PATH=$PATH:$HADOOP_HOME/bin
export PATH=$PATH:$HADOOP_HOME/sbin
EOF


source ~/.bashrc

useradd hadoop
passwd hadoop

mkdir /opt/module
chown -R hadoop:hadoop /opt/module</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hadoop安装配置">25.2. hadoop安装配置</h3>
<div class="listingblock">
<div class="title">在bigdata1执行以下命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">su hadoop
ssh-keygen -t rsa

ssh-copy-id bigdata1
ssh-copy-id bigdata2
ssh-copy-id bigdata3

cd /opt/module
wget https://dlcdn.apache.org/hadoop/common/hadoop-3.3.6/hadoop-3.3.6.tar.gz

tar xf hadoop-3.3.6.tar.gz

hadoop version</code></pre>
</div>
</div>
<div class="paragraph">
<p>hadoop 的安装完成，到这里，单台机器的软件已经安装完成，接下来使用rsync将安装好的软件拷贝到bigdata2和bigdata3</p>
</div>
<div class="listingblock">
<div class="title">拷贝hadoop</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rsync -rvl /opt/module/ hadoop@bigdata2:/opt/module
rsync -rvl /opt/module/ hadoop@bigdata3:/opt/module</code></pre>
</div>
</div>
<div class="paragraph">
<p>至此，所有软件安装完成</p>
</div>
<div class="paragraph">
<p>基础环境配置完成后，需要对集群中服务器做规划，让每台服务器承担不同的角色。
具体规划如下，最重要的 NameNode 放在第一台服务器上，yarn 的 ResourceManager 放在 第二台服务器上，SecondaryNamenode 则放在第三台服务器上。
具体规划如下：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. 集群规划</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">用途</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigdata1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigdata2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bigdata3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HDFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NameNode DataNode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataNode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SecondaryNameNode DataNode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">YARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NodeManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ResourceManager NodeManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NodeManager</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>接下来编辑配置文件</p>
</div>
<div class="listingblock">
<div class="title">进入配置文件目录</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /opt/module/hadoop-3.3.6/etc/hadoop</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">core-site.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi core-site.xml

&lt;property&gt;
    &lt;name&gt;fs.defaultFS&lt;/name&gt;
    &lt;value&gt;hdfs://bigdata1:9000&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
    &lt;value&gt;/opt/module/hadoop-3.3.6/data/tmp&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">hadoop-env.sh</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi hadoop-env.sh

export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.18.0.10-3.el9.x86_64/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">hdfs-site.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi hdfs-site.xml

&lt;property&gt;
    &lt;name&gt;dfs.replication&lt;/name&gt;
    &lt;value&gt;3&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;
    &lt;value&gt;bigdata3:50090&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">yarn-env.sh</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi yarn-env.sh

export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.18.0.10-3.el9.x86_64/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">yarn-site.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi yarn-site.xml

&lt;property&gt;
    &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
    &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;
    &lt;value&gt;bigdata2&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">mapred-env.sh</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi mapred-env.sh

export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-11.0.18.0.10-3.el9.x86_64/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">mapred-site.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi mapred-site.xml

&lt;property&gt;
    &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
    &lt;value&gt;yarn&lt;/value&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">workers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi workers

bigdata1
bigdata2
bigdata3</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后将配置同步到另外两台机器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rsync -rvl /opt/module/hadoop-3.3.6/ hadoop@bigdata2:/opt/module/hadoop-3.3.6
rsync -rvl /opt/module/hadoop-3.3.6/ hadoop@bigdata3:/opt/module/hadoop-3.3.6</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_集群操作">25.3. 集群操作</h3>
<div class="paragraph">
<p>接下来启动集群，首次启动集群需要对 NameNode 进行格式化：</p>
</div>
<div class="listingblock">
<div class="title">在bigdata1上执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#对NameNode 进行格式化
cd /opt/module/hadoop-3.3.6
bin/hdfsnamenode-format

#启动 hdfs
sbin/start-dfs.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在bigdata2上执行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#启动 yarn
sbin/start-yarn.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>访问一下网址需要添加本地域名解析</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">然后访问</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="http://bigdata3:50090/" class="bare">http://bigdata3:50090/</a></p>
</li>
<li>
<p><a href="http://bigdata1:9870/" class="bare">http://bigdata1:9870/</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wordpress">26. WordPress</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_配置内网环境一安装nginx">26.1. 配置内网环境一：安装Nginx</h3>
<div class="paragraph">
<p>操作同<a href="#Nginx_install_chapter">配置内网环境一：安装Nginx</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_配置内网环境二安装php">26.2. 配置内网环境二：安装PHP</h3>
<div class="paragraph">
<p>操作同<a href="#PHP_install_chapter">配置内网环境二：安装PHP</a></p>
</div>
</div>
<div class="sect2">
<h3 id="mariadb_install_chapter">26.3. 配置内网环境三：安装mariadb</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#安装mariadb
yum install -y mariadb mariadb-server

#开启mariadb服务并设置开机自启动
systemctl start mariadb
systemctl enable mariadb

#查看服务状态
systemctl status mariadb

#进入 MariaDB
mysql

#创建数据库与用户
CREATE DATABASE wordpress;
CREATE USER 'user'@'localhost' IDENTIFIED BY '123456';
GRANT ALL PRIVILEGES ON wordpress.* TO 'user'@'localhost';
ALTER USER root@localhost IDENTIFIED VIA mysql_native_password USING PASSWORD('输入您的密码');
FLUSH PRIVILEGES;


#退出数据库
\q</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_配置内网环境四安装wordpress">26.4. 配置内网环境四：安装WordPress</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /usr/share/nginx/html
wget https://cn.wordpress.org/wordpress-6.3.2-zh_CN.tar.gz
tar xf wordpress-6.3.2-zh_CN.tar.gz
cd /usr/share/nginx/html/wordpress
cp wp-config-sample.php wp-config.php</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">编辑wp-config.php文件</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim wp-config.php</code></pre>
</div>
</div>
<div class="paragraph">
<p>找到文件中 MySQL 的部分，并将相关配置信息修改为
<a href="#mariadb_install_chapter">安装mariadb </a>时配置部分
的内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre> // ** MySQL settings - You can get this info from your web host ** //
 /** The name of the database for WordPress */
 define('DB_NAME', 'wordpress');

 /** MySQL database username */
 define('DB_USER', 'user');

 /** MySQL database password */
 define('DB_PASSWORD', '123456');

 /** MySQL hostname */
 define('DB_HOST', 'localhost');</pre>
</div>
</div>
<div class="paragraph">
<p>在浏览器地址栏输入http://域名或云服务器实例的公网 IP/wordpress</p>
</div>
<div class="paragraph">
<p>例如 <code><a href="http://192.xxx.xxx.xx/wordpress" class="bare">http://192.xxx.xxx.xx/wordpress</a></code>
转至 WordPress 安装页，开始配置 WordPress。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/WordPress_install_01.png" alt="WordPress install 01">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_elasticsearch">27. ElasticSearch</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>环境准备</p>
<div class="ulist">
<ul>
<li>
<p>操作系统：centos-stream9</p>
</li>
<li>
<p>cpu：两核</p>
</li>
<li>
<p>内存：4G</p>
</li>
<li>
<p>Elasticsearch版本：8.10</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ElasticSearch_install_chapter">27.1. ElasticSearch安装</h3>
<div class="ulist">
<ul>
<li>
<p>官方文档： <a href="https://www.elastic.co/guide/en/elasticsearch/reference/8.10/install-elasticsearch.html" class="bare">https://www.elastic.co/guide/en/elasticsearch/reference/8.10/install-elasticsearch.html</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">安装elasticsearch</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#下载并安装公共签名密钥:
rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch

#添加仓库
cat &lt;&lt; EOF &gt;/etc/yum.repos.d/elasticsearch.repo
[elasticsearch]
name=Elasticsearch repository for 8.x packages
baseurl=https://artifacts.elastic.co/packages/8.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=0
autorefresh=1
type=rpm-md
EOF

#安装elasticsearch
sudo yum install -y --enablerepo=elasticsearch elasticsearch</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
安装时会自动创建一个超级用户elastic，并在终端输出它的密码，记住该密码,将用于后续kibana前端登陆和filebeat的配置
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">将密码存储在变量ELASTIC_PASSWORD中</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#例：假设密码是vjT4*xK-Q_o__oXMWRY9则执行
export ELASTIC_PASSWORD="vjT4*xK-Q_o__oXMWRY9"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">更改以下配置</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/elasticsearch/elasticsearch.yml
#将相关内容更改为以下值
xpack.security.enabled: false

xpack.security.enrollment.enabled: false

xpack.security.http.ssl:
  enabled: false

xpack.security.transport.ssl:
  enabled: false</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">启动Elasticsearch</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#重新加载systemd管理配置
sudo /bin/systemctl daemon-reload
#设置开机自启动
sudo /bin/systemctl enable elasticsearch.service
#开启服务
sudo systemctl start elasticsearch.service
#查看服务状态
sudo systemctl status elasticsearch.service</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">检查Elasticsearch是否正在运行</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl  -u elastic:$ELASTIC_PASSWORD http://localhost:9200</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>{
  "name" : "Cp8oag6",
  "cluster_name" : "elasticsearch",
  "cluster_uuid" : "AT69_T_DTp-1qgIJlatQqA",
  "version" : {
    "number" : "8.10.4",
    "build_type" : "tar",
    "build_hash" : "f27399d",
    "build_flavor" : "default",
    "build_date" : "2016-03-30T09:51:41.449Z",
    "build_snapshot" : false,
    "lucene_version" : "9.7.0",
    "minimum_wire_compatibility_version" : "1.2.3",
    "minimum_index_compatibility_version" : "1.2.3"
  },
  "tagline" : "You Know, for Search"
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kibana安装">27.2. Kibana安装</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果Kibana与ElasticSearch装在同一台主机上，则主机内存要求4G以上
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#添加kibana仓库
cat &lt;&lt; EOF &gt;/etc/yum.repos.d/kibana.repo
[kibana-8.x]
name=Kibana repository for 8.x packages
baseurl=https://artifacts.elastic.co/packages/8.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=1
autorefresh=1
type=rpm-md
EOF

#安装kibana
sudo yum install -y kibana</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">编辑kibana.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/kibana/kibana.yml
#更改对应配置为以下值
server.port: 5601
server.host: "0.0.0.0"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#启动kibana
sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable kibana
sudo systemctl start kibana</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">检查kibana是否正常启动</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -I  http://localhost:5601</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>HTTP/1.1 200 OK
x-content-type-options: nosniff
referrer-policy: no-referrer-when-downgrade
permissions-policy: camera=(), display-capture=(), fullscreen=(self), geolocation=(), microphone=(), web-share=()
cross-origin-opener-policy: same-origin
content-security-policy: script-src 'self'; worker-src blob: 'self'; style-src 'unsafe-inline' 'self'
kbn-name: es3
content-type: text/html; charset=utf-8
cache-control: private, no-cache, no-store, must-revalidate
content-length: 90867
vary: accept-encoding
Date: Wed, 01 Nov 2023 12:04:55 GMT
Connection: keep-alive
Keep-Alive: timeout=120</pre>
</div>
</div>
<div class="paragraph">
<p>至此，kibana已经正常启动</p>
</div>
<div class="paragraph">
<p>浏览器访问
<a href="http://部署kibana的主机IP:5601/" class="bare">http://部署kibana的主机IP:5601/</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/kibana_install_01.png" alt="kibana install 01">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filebeat安装">27.3. filebeat安装</h3>
<div class="ulist">
<ul>
<li>
<p>官方文档: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html#filebeat-installation-configuration" class="bare">https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html#filebeat-installation-configuration</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
将filebeat安装在需要管理的服务器上。本例中将filebeat安装在与ElasticSearch相同的主机上
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir downloads
cd downloads/
curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.10.4-x86_64.rpm
sudo rpm -vi filebeat-8.10.4-x86_64.rpm</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/filebeat/filebeat.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置Filebeat可以找到Elasticsearch安装的主机和端口，并设置有权安装Filebeat的用户名和密码(密码则为<a href="#ElasticSearch_install_chapter">ElaxticSearch安装</a> 时生成的默认密码)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#找到以下配置更改并更改对应的值
output.elasticsearch:
  hosts: ["http://安装ElasticSearch主机的ip:9200"]
  username: "elastic"
  password: "vjT4*xK-Q_o__oXMWRY9"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#列出filebeat可用模块
filebeat modules list

#启用nginx模块配置
filebeat modules enable nginx

#更改nginx模块配置
#var.paths为nginx的access.log路径
vim /etc/filebeat/modules.d/nginx.yml
- module: nginx
  access:
    enabled: true
    var.paths: ["/var/log/nginx/access.log*"]

#Filebeat 提供了预定义的数据解析、索引和可视化资源。
#加载这些资源
filebeat setup -e

#启动filebeat
systemctl enable filebeat
systemctl start filebeat
systemctl status filebeat</code></pre>
</div>
</div>
<div class="paragraph">
<p>访问
<a href="http://安装kibana主机的ip:5601" class="bare">http://安装kibana主机的ip:5601</a></p>
</div>
<div class="paragraph">
<p>在侧边导航区单击“Discover”。为了查看Filebeat数据，请确保选择预定义的Filebeat -*索引模式，此时还没有数据</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/filebeat_install_01.png" alt="filebeat install 01">
</div>
</div>
<div class="listingblock">
<div class="title">为产生日志数据用于检测，安装nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">yum install -y nginx
systemctl enable nginx
systemctl start nginx
systemctl status nginx

#用于请求nginx默认界面的脚本
cat &lt;&lt; EOF &gt;filebeat.sh
#!/bin/bash
while true;
do
    curl -I http://nginx主机的ip:80
    sleep 1
done
EOF

sh filebeat.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>等待1分钟刷新界面即可看到</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/filebeat_install_02.png" alt="filebeat install 02">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
如果在Kibana中看不到数据，请尝试将time filter更改为更大的范围。默认情况下，Kibana显示最近15分钟。
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_minikube">28. minikube</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_minikube安装">28.1. minikube安装</h3>
<div class="ulist">
<ul>
<li>
<p>环境准备</p>
<div class="ulist">
<ul>
<li>
<p>2 CPUs</p>
</li>
<li>
<p>2GB 内存</p>
</li>
<li>
<p>20GB 可用磁盘空间</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">安装minikube</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir /root/downloads
cd /root/downloads
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-latest.x86_64.rpm
sudo rpm -Uvh minikube-latest.x86_64.rpm</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">安装docker</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

sudo systemctl start docker
#运行hello-world image测试是否已经正确安装docker
sudo docker run hello-world</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/</pre>
</div>
</div>
<div class="paragraph">
<p>至此docker已经成功正确安装</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">adduser czh
passwd czh
echo 'czh   ALL=(ALL) ALL' &gt;&gt; /etc/sudoers
su czh
sudo usermod -aG docker $USER &amp;&amp; newgrp docker

#使用docker driver启动集群:
minikube start --driver=docker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>[czh@K8S-1 root]$ minikube start --driver=docker
😄  minikube v1.31.2 on Centos 9 (kvm/amd64)
✨  Using the docker driver based on user configuration
📌  Using Docker driver with root privileges
👍  Starting control plane node minikube in cluster minikube
🚜  Pulling base image ...
💾  Downloading Kubernetes v1.27.4 preload ...
    &gt; preloaded-images-k8s-v18-v1...:  393.21 MiB / 393.21 MiB  100.00% 25.86 M
    &gt; index.docker.io/kicbase/sta...:  447.62 MiB / 447.62 MiB  100.00% 3.98 Mi
❗  minikube was unable to download gcr.io/k8s-minikube/kicbase:v0.0.40, but successfully downloaded docker.io/kicbase/stable:v0.0.40 as a fallback image
🔥  Creating docker container (CPUs=2, Memory=2200MB) ...
🐳  Preparing Kubernetes v1.27.4 on Docker 24.0.4 ...
    ▪ Generating certificates and keys ...
    ▪ Booting up control plane ...
    ▪ Configuring RBAC rules ...
🔗  Configuring bridge CNI (Container Networking Interface) ...
🔎  Verifying Kubernetes components...
    ▪ Using image gcr.io/k8s-minikube/storage-provisioner:v5
🌟  Enabled addons: storage-provisioner, default-storageclass
💡  kubectl not found. If you need it, try: 'minikube kubectl -- get pods -A'
🏄  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#设置docker为默认driver:
minikube config set driver docker


#添加kubectl仓库
cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/
enabled=1
gpgcheck=1
gpgkey=https://pkgs.k8s.io/core:/stable:/v1.28/rpm/repodata/repomd.xml.key
EOF

#安装kubectl
sudo yum install -y kubectl

#创建一个sample,并开放8080端口:
kubectl create deployment hello-minikube --image=kicbase/echo-server:1.0
kubectl expose deployment hello-minikube --type=NodePort --port=8080

#查看hello-minikube服务
kubectl get services hello-minikube

#使用minikube启动一个web browser
kubectl port-forward service/hello-minikube 7080:8080 --address 0.0.0.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>Forwarding from 0.0.0.0:7080 -&gt; 8080
Handling connection for 7080
Handling connection for 7080
Handling connection for 7080</pre>
</div>
</div>
<div class="paragraph">
<p>在另一个终端执行</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -I http://localhost:7080/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>HTTP/1.1 200 OK
Content-Type: text/plain
Date: Thu, 02 Nov 2023 09:18:38 GMT
Content-Length: 131</pre>
</div>
</div>
<div class="paragraph">
<p>浏览器访问http://搭建minikube的主机ip:7080/</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/minikube_install_01.png" alt="minikube install 01">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_k8s">28.2. k8s</h3>
<div class="sect3">
<h4 id="_常用命令_2">28.2.1. 常用命令</h4>
<div class="listingblock">
<div class="title">常用命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#创建deployment
kubectl create deployment kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1

#列出deployments
kubectl get deployments

#创建proxy创建一个代理，将通信转发到集群范围内的专用网络中
kubectl proxy

#查看正在运行的pods
kubectl get pods

#查看pod中的container和image相关信息
kubectl describe pods

#查看pod日志
kubectl logs "$POD_NAME"

#列出环境变量
kubectl exec "$POD_NAME" -- env

#进入pod中的容器
kubectl exec -ti $POD_NAME -- bash

#拓展deployment副本到4个副本
kubectl scale deployments/kubernetes-bootcamp --replicas=4

#缩减deployment副本到2个副本
kubectl scale deployments/kubernetes-bootcamp --replicas=2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">更新</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#列出已有pods
kubectl get pods

#查看应用程序的当前image版本
kubectl describe pods

#将应用程序的镜像更新到version 2(该命令通知deployment为您的应用程序使用不同的image并启动滚动更新)
kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2

#检查新 Pod 的状态，并查看旧Pod终止
kubectl get pods

#验证更新
kubectl rollout status deployments/kubernetes-bootcamp

#查看应用程序的当前镜像版本
kubectl describe pods

#将deployment回滚到上一个工作版本
kubectl rollout undo deployments/kubernetes-bootcamp</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker">29. Docker</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_docker安装">29.1. Docker安装</h3>
<div class="ulist">
<ul>
<li>
<p>系统：centos-stream-9</p>
</li>
<li>
<p>cpu 2</p>
</li>
<li>
<p>内存 4G</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">安装docker</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
sudo yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

sudo systemctl enable docker
sudo systemctl start docker
#运行hello-world image测试是否已经正确安装docker
sudo docker run hello-world</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/</pre>
</div>
</div>
<div class="paragraph">
<p>至此docker已经成功正确安装</p>
</div>
</div>
<div class="sect2">
<h3 id="_常用命令_3">29.2. 常用命令</h3>
<div class="listingblock">
<div class="title">常用命令</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#构建镜像并指定镜像名称和标签
docker build -t testdemo:v1 .

#创建容器
docker run -d --privileged -p 8000(宿主机端口):8080(容器内端口) --name testdemo testdemo:v1

#进入容器
docker exec -it [containerID/containerNAME] /bin/bash

#查看日志
docker logs [containerID/containerNAME]
#日志持续输出到控制台
docker logs -f [containerID/containerNAME]
#输出日志末尾3行
docker logs --tail 3 [containerID/containerNAME]</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nginx">30. Nginx</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_proxy_pass">30.1. proxy_pass</h3>
<div class="paragraph">
<p>官方文档
<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" class="bare">http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass</a></p>
</div>
<div class="listingblock">
<div class="title">添加本地域名解析</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;&gt; /etc/hosts
127.0.0.1 test.testdemo.com
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/nginx/nginx.conf

#添加一个server模块测试
server {
        listen      80;
        server_name test.testdemo.com;

        # 转发请求到 http://www.example.com
        location / {
            proxy_pass http://www.baidu.com;
        }
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">重载nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nginx -t &amp;&amp; nginx -s reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>浏览器访问 [<a href="http://test.nginx.com" class="bare">http://test.nginx.com</a>]</p>
</div>
<div class="paragraph">
<p>页面将自动跳转到百度首页</p>
</div>
</div>
<div class="sect2">
<h3 id="_try_files">30.2. try_files</h3>
<div class="paragraph">
<p>官方文档
<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files" class="bare">http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files</a></p>
</div>
<div class="listingblock">
<div class="title">添加本地域名解析</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;&gt; /etc/hosts
127.0.0.1 test.testdemo.com
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>在/data/images/目录下存放一张图片123.png</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/nginx/nginx.conf

#添加一个server模块测试
server {
        location /images/ {
            root /data;
            try_files $uri  $uri/  /images/index.html;
        }
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">重载nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nginx -t &amp;&amp; nginx -s reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>浏览器访问 <a href="http://test.nginx.com/images/123.png" class="bare">http://test.nginx.com/images/123.png</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>因为uri:123.png存在，可正常访问资源，此时完整的url是
<a href="http://test.nginx.com/images/123.png" class="bare">http://test.nginx.com/images/123.png</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>浏览器访问 <a href="http://test.nginx.com/images/123.pn" class="bare">http://test.nginx.com/images/123.pn</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>将依次访问http://test.nginx.com/images/123.pn，123.pn不存在，则按照try_files中的顺序，访问http://test.nginx.com/images/123.pn/依然不存在，最后访问http://test.nginx.com/images/index.html</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>页面将自动跳转到百度首页</p>
</div>
</div>
<div class="sect2">
<h3 id="_rewrite">30.3. rewrite</h3>
<div class="paragraph">
<p>官方文档
<a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#rewrite" class="bare">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#rewrite</a></p>
</div>
<div class="listingblock">
<div class="title">添加本地域名解析</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;&gt; /etc/hosts
127.0.0.1 test.testdemo.com
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/nginx/nginx.conf

#添加一个server模块 测试
server {
        location / {
            rewrite ^/(.*) http://www.baidu.com;
        }
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">重载nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nginx -t &amp;&amp; nginx -s reload</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>浏览器访问 <a href="http://test.testdemo.com" class="bare">http://test.testdemo.com</a></p>
<div class="ulist">
<ul>
<li>
<p>页面将自动跳转到百度首页</p>
</li>
</ul>
</div>
</li>
<li>
<p>浏览器访问 <a href="http://test.testdemo.com/data/images/123.png" class="bare">http://test.testdemo.com/data/images/123.png</a></p>
<div class="ulist">
<ul>
<li>
<p>页面也自动跳转到百度首页</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>任何以“/”开头的uri都将自动跳转</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>语法 rewrite regex replacement [flag];</p>
</div>
<div class="ulist">
<ul>
<li>
<p>regex是匹配uri的正则表达式</p>
</li>
<li>
<p>replacement是需要替换成的uri</p>
</li>
<li>
<p>flag可替换为[last/break/redirect/permanent]</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_return">30.4. return</h3>
<div class="paragraph">
<p>官方文档
<a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return" class="bare">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return</a></p>
</div>
<div class="listingblock">
<div class="title">添加本地域名解析</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF &gt;&gt; /etc/hosts
127.0.0.1 test.testdemo.com
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/nginx/nginx.conf

#添加一个server模块测试
server {
        location / {
            root /data/images/;
            return 200;
        }
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">重载nginx</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nginx -t &amp;&amp; nginx -s reload</code></pre>
</div>
</div>
<div class="paragraph">
<p>浏览器访问 <a href="http://test.nginx.com/123.png" class="bare">http://test.nginx.com/123.png</a></p>
</div>
<div class="paragraph">
<p>页面将返回200状态码</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java">31. java</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_java安装">31.1. java安装</h3>
<div class="sect3">
<h4 id="_linuxcentos_stream9">31.1.1. linux(centos-stream9)</h4>
<div class="listingblock">
<div class="title">java8</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#安装java8
yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel java-1.8.0-openjdk-headless

#查看当前java环境
java -version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">java11</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#安装java11
yum install -y java-11-openjdk java-11-openjdk-devel java-11-openjdk-headless

#查看当前java环境
java -version</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">java17</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#安装java17
yum install -y java-17-openjdk java-17-openjdk-devel java-11-openjdk-headless

#查看当前java环境
java -version</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_windows10">31.1.2. windows10</h4>
<div class="paragraph">
<p>一、下载jdk,下载地址：https://www.oracle.com/java/technologies/downloads/， windows 下载.msi格式。</p>
</div>
<div class="paragraph">
<p>二、点击安装包安装到对应目录。</p>
</div>
<div class="paragraph">
<p>三、 配置环境变量：</p>
</div>
<div class="paragraph">
<p>在 "系统变量" 中设置 3 项属性，JAVA_HOME、PATH、CLASSPATH(大小写无所谓),若已存在则点击"编辑"，不存在则点击"新建"。</p>
</div>
<div class="paragraph">
<p>此电脑&#8594;右键&#8594;属性&#8594;关于&#8594;高级系统设置&#8594;高级&#8594;环境变量</p>
</div>
<div class="listingblock">
<div class="title">变量设置参数如下：</div>
<div class="content">
<pre>变量名：JAVA17
变量值：C:\Program Files (x86)\Java\jdk17        // 要根据自己的实际路径配置
变量名：JAVA_HOME
变量值：%JAVA17%
变量名：CLASSPATH
变量值：.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;         //记得前面有个"."
变量名：Path
变量值：%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin;</pre>
</div>
</div>
<div class="paragraph">
<p>四、 测试JDK是否安装成功</p>
</div>
<div class="paragraph">
<p>1、"开始"&#8594;"运行"，键入"cmd"</p>
</div>
<div class="paragraph">
<p>2、键入命令: java -version、java、javac 几个命令，出现信息，说明环境变量配置成功；</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java环境切换">31.2. java环境切换</h3>
<div class="paragraph">
<p>如果您从CentOS官方存储库安装了多个版本的Java，则可以使用 <code>alternatives</code> 来切换它们。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[root@dlp ~]# alternatives --config java

There are 3 programs which provide 'java'.

  Selection    Command
-----------------------------------------------
   1           java-1.8.0-openjdk.x86_64 (/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.332.b09-1.el9.x86_64/jre/bin/java)
*+ 2           java-11-openjdk.x86_64 (/usr/lib/jvm/java-11-openjdk-11.0.15.0.10-1.el9.x86_64/bin/java)
   3           java-17-openjdk.x86_64 (/usr/lib/jvm/java-17-openjdk-17.0.3.0.7-1.el9.x86_64/bin/java)

Enter to keep the current selection[+], or type selection number: 3

[root@dlp ~]# alternatives --config javac

There are 3 programs which provide 'javac'.

  Selection    Command
-----------------------------------------------
   1           java-1.8.0-openjdk.x86_64 (/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.332.b09-1.el9.x86_64/bin/javac)
*+ 2           java-11-openjdk.x86_64 (/usr/lib/jvm/java-11-openjdk-11.0.15.0.10-1.el9.x86_64/bin/javac)
   3           java-17-openjdk.x86_64 (/usr/lib/jvm/java-17-openjdk-17.0.3.0.7-1.el9.x86_64/bin/javac)

Enter to keep the current selection[+], or type selection number: 3

[root@dlp ~]# java --version
openjdk 17.0.3 2022-04-19 LTS
OpenJDK Runtime Environment 21.9 (build 17.0.3+7-LTS)
OpenJDK 64-Bit Server VM 21.9 (build 17.0.3+7-LTS, mixed mode, sharing)
[root@dlp ~]# javac --version
javac 17.0.3</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gradle换源">31.3. gradle换源</h3>
<div class="ulist">
<ul>
<li>
<p>Reference: <a href="https://www.cnblogs.com/bluestorm/p/14761482.html" class="bare">https://www.cnblogs.com/bluestorm/p/14761482.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>项目目录&#8594;gradle&#8594;wrapper&#8594;gradle-wrapper.properties</p>
</div>
<div class="paragraph">
<p>更改 <code>distributionUrl</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>可选url:</p>
<div class="ulist">
<ul>
<li>
<p>腾讯云: <a href="https://mirrors.cloud.tencent.com/gradle/" class="bare">https://mirrors.cloud.tencent.com/gradle/</a></p>
</li>
<li>
<p>阿里云: <a href="https://mirrors.aliyun.com/macports/distfiles/gradle/" class="bare">https://mirrors.aliyun.com/macports/distfiles/gradle/</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>更改后：
<code>distributionUrl=https\://mirrors.cloud.tencent.com/gradle/gradle-xx-xx</code> ①</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>①处根据自身选择合适版本</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>最后打开终端，进入project所在的目录</p>
</div>
<div class="listingblock">
<div class="title">在linux中</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew bootRun</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">在windows中</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">.\gradlew.bat bootRun</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">终端输出</div>
<div class="content">
<pre>Downloading https://mirrors.aliyun.com/macports/distfiles/gradle/gradle-7.4.2-bin.zip
...........10%...........20%...........30%...........40%...........50%...........60%...........70%...........80%...........90%...........100%
Starting a Gradle Daemon, 1 busy and 1 stopped Daemons could not be reused, use --status for details...........
.....
.....</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maven换源">31.4. maven换源</h3>
<div class="ulist">
<ul>
<li>
<p>Reference: <a href="https://blog.csdn.net/mnmiaoyi/article/details/124216887" class="bare">https://blog.csdn.net/mnmiaoyi/article/details/124216887</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_方法一">31.4.1. 方法一：</h4>
<div class="paragraph">
<p>项目目录/.mvn/wrapper/maven-wrapper.properties</p>
</div>
<div class="paragraph">
<p>更改 <code>distributionUrl</code> 和 <code>wrapperUrl</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>distributionUrl=https://maven.aliyun.com/repository/central/org/apache/maven/apache-maven/3.6.3/apache-maven-3.6.3-bin.zip
wrapperUrl=https://maven.aliyun.com/repository/central/io/takari/maven-wrapper/0.5.6/maven-wrapper-0.5.6.jar

# distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.6.3/apache-maven-3.6.3-bin.zip
# wrapperUrl=https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/0.5.6/maven-wrapper-0.5.6.jar</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_方法二">31.4.2. 方法二：</h4>
<div class="paragraph">
<p>参考阿里云: <a href="https://developer.aliyun.com/mvn/guide" class="bare">https://developer.aliyun.com/mvn/guide</a></p>
</div>
<div class="paragraph">
<p>参考腾讯云: <a href="https://mirrors.tencent.com/help/maven.html" class="bare">https://mirrors.tencent.com/help/maven.html</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>settings.xml路径可使用everything搜索：
参考路径：
D:\Installations\IDEA\IntelliJ IDEA 2023.3.2\plugins\maven\lib\maven3\conf\settings.xml</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kvm">32. kvm</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_kvm虚拟机使用usb">32.1. kvm虚拟机使用usb</h3>
<div class="listingblock">
<div class="title">查看usb的vendor 和product</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">lsusb</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre>Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 003 Device 002: ID 30fa:0400  USB OPTICAL MOUSE
Bus 003 Device 003: ID 30c9:0069 Luxvisions Innotech Limited HP Wide Vision HD Camera
Bus 003 Device 004: ID 8087:0033 Intel Corp. AX211 Bluetooth
Bus 004 Device 001: ID 03f0:1617 Linux Foundation 3.0 root hub</pre>
</div>
</div>
<div class="paragraph">
<p>将以下内容添加到虚拟机.xml文件的"devices" block</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;hostdev mode='subsystem' type='usb'&gt;
  &lt;source startupPolicy='optional'&gt;
    &lt;vendor id='0x03f0'/&gt;
    &lt;product id='0x1617'/&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>然后</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">virsh undefine 虚拟机名字
virsh define 虚拟机.xml</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_开机自动执行脚本">33. 开机自动执行脚本</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_方法一修改_etcrc_drc_local_文件">33.1. 方法一：修改 /etc/rc.d/rc.local 文件</h3>
<div class="paragraph">
<p>/etc/rc.d/rc.local 文件会在 Linux 系统各项服务都启动完毕之后再被运行。所以你想要自己的脚本在开机后被运行的话，可以将自己脚本路径加到该文件里。</p>
</div>
<div class="paragraph">
<p>但是，首先需要确认你有运行这个文件的权限。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#添加执行权限
chmod +x /etc/rc.d/rc.local

#测试脚本auto_run_script.sh：在家目录下写入日期
cat &lt;&lt;EOF &gt; /root/auto_run_script.sh
#!/bin/bash
date &gt;&gt; /root/test.txt
EOF

#赋予可执行权限：
chmod +x /root/auto_run_script.sh

#将auto_run_script.sh追加到/etc/rc.d/rc.local
cat &lt;&lt;EOF &gt;&gt; /etc/rc.d/rc.local
/root/auto_run_script.sh
EOF

接下来，我们就可以试试效果了。直接重启系统就可以了：

$ sudo reboot</code></pre>
</div>
</div>
<div class="paragraph">
<p>重启之后，就会在家目录下看到脚本执行的结果了。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat /root/test.txt</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_方法二使用_crontab">33.2. 方法二：使用 crontab</h3>
<div class="paragraph">
<p>crontab 是 Linux 下的计划任务，当时间达到我们设定的时间时，可以自动触发某些脚本的运行。
我们可以自己设置计划任务时间，然后编写对应的脚本。但是，有个特殊的任务，叫作 @reboot ，我们其实也可以直接从它的字面意义看出来，这个任务就是在系统重启之后自动运行某个脚本。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">crontab -e</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#输入需要执行的脚本位置
@reboot /root/auto_run_script.sh</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_frp_chapter">34. ftp</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ftp站点搭建">34.1. FTP站点搭建</h3>
<div class="paragraph">
<p>Reference： <a href="https://help.aliyun.com/zh/ecs/use-cases/build-an-ftp-site-on-an-instance-that-runs-alibaba-cloud-linux" class="bare">https://help.aliyun.com/zh/ecs/use-cases/build-an-ftp-site-on-an-instance-that-runs-alibaba-cloud-linux</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>操作系统：centos-stream9</p>
</li>
<li>
<p>vsftpd：3.0.3</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_步骤一安装vsftpd">34.1.1. 步骤一：安装vsftpd</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#安装并启动vsftpd服务
dnf install -y vsftpd
systemctl enable vsftpd.service
systemctl start vsftpd.service</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>执行 <code>systemctl start vsftpd.service</code> 时如果提示错误信息Job for vsftpd.service failed because the control process exited with error code，请排查是否存在下述问题，排查后重新启动FTP。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>21端口被占用时，使用lsof -i:21命令查看是否存在进程，如果存在进程，使用kill -9 &lt;进程号&gt;命令杀掉进程。</p>
</li>
<li>
<p>网络环境不支持IPv6时，运行命令vim /etc/vsftpd/vsftpd.conf将内容listen_ipv6=YES修改为listen_ipv6=NO。</p>
</li>
<li>
<p>MAC地址不匹配时，运行命令ifconfig查看MAC地址，并使用vim /etc/sysconfig/network-scripts/ifcfg-eth0命令新增或修改HWADDR=&lt;MAC地址&gt;参数。MAC地址如下所示。</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ftp_01.png" alt="ftp 01">
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#安装net-tools
yum install -y net-tools
#查看FTP服务监听的端口
netstat -antup | grep ftp</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">出现类似如下回显信息，表示FTP服务已启动，监听的端口号为21。</div>
<div class="content">
<pre>[root@iZbp14h7n3cwipjln62**** ~]# netstat -antup | grep ftp
tcp6       0      0 :::21                   :::*                    LISTEN      5870/vsftpd</pre>
</div>
</div>
<div class="paragraph">
<p>此时，vsftpd默认已开启本地用户模式，您还需要继续进行配置才能正常使用FTP服务。</p>
</div>
</div>
<div class="sect3">
<h4 id="_步骤二配置vsftpd">34.1.2. 步骤二：配置vsftpd</h4>
<div class="paragraph">
<p>为保证数据安全，本文主要介绍被动模式下，使用本地用户访问FTP服务器的配置方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#运行以下命令为FTP服务创建一个Linux用户。本示例中，该用户名为ftptest。
adduser ftptest

#运行以下命令，修改ftptest用户的密码。
passwd ftptest

#创建一个供FTP服务使用的文件目录。本示例以/var/ftp/test为例。
mkdir /var/ftp/test

#创建测试文件。
touch /var/ftp/test/testfile.txt

#运行以下命令，更改/var/ftp/test目录的拥有者为ftptest。
chown -R ftptest:ftptest /var/ftp/test

#修改vsftpd.conf配置文件。
vim /etc/vsftpd/vsftpd.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置FTP服务器为被动模式。</p>
</div>
<div class="listingblock">
<div class="title">具体的配置参数说明如下，除下面提及的参数，其他参数保持默认值即可。</div>
<div class="content">
<pre>#禁止匿名登录FTP服务器。
anonymous_enable=NO
#允许本地用户登录FTP服务器。
local_enable=YES
#监听IPv4 sockets。
listen=YES</pre>
</div>
</div>
<div class="listingblock">
<div class="title">在行首添加#注释掉以下参数，关闭监听IPv6 sockets：</div>
<div class="content">
<pre>#listen_ipv6=YES</pre>
</div>
</div>
<div class="listingblock">
<div class="title">在配置文件的末尾添加下列参数，其中pasv_address需修改为FTP服务器的公网IP地址。</div>
<div class="content">
<pre>#设置本地用户登录后所在目录。
local_root=/var/ftp/test
#全部用户被限制在主目录。
chroot_local_user=YES
#启用例外用户名单。
chroot_list_enable=YES
#指定例外用户列表文件，列表中用户不被锁定在主目录。
chroot_list_file=/etc/vsftpd/chroot_list
#开启被动模式。
pasv_enable=YES
allow_writeable_chroot=YES
#本教程中为Linux实例的公网IP。
pasv_address=&lt;FTP服务器公网IP地址&gt;
#设置被动模式下，建立数据传输可使用的端口范围的最小值。
#建议您把端口范围设置在一段比较高的范围内，例如50000~50010，有助于提高访问FTP服务器的安全性。
pasv_min_port=50000
#设置被动模式下，建立数据传输可使用的端口范围的最大值。
pasv_max_port=50010</pre>
</div>
</div>
<div class="paragraph">
<p>保存并关闭文件</p>
</div>
<div class="listingblock">
<div class="title">创建chroot_list文件，并在文件中写入例外用户名单。</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vim /etc/vsftpd/chroot_list</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>没有例外用户时，也必须创建chroot_list文件，内容可为空。</p>
</div>
<div class="paragraph">
<p>输入例外用户名单。此名单中的用户不会被锁定在主目录，可以访问其他目录。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">重启vsftpd服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">systemctl restart vsftpd.service</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_步骤三新增防火墙规则">34.1.3. 步骤三：新增防火墙规则</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">firewall-cmd --zone=public --add-port=21/tcp --permanent
firewall-cmd --zone=public --add-port=50000-50010/tcp --permanent
firewall-cmd --reload</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_步骤四客户端测试">34.1.4. 步骤四：客户端测试</h4>
<div class="paragraph">
<p>FTP客户端、Windows命令行工具或浏览器均可用来测试FTP服务器。本文以Win10系统的本地主机作为FTP客户端，介绍FTP服务器的访问步骤。
在本地主机中，打开文件管理器。</p>
</div>
<div class="paragraph">
<p>在地址栏中输入ftp://&lt;FTP服务器公网IP地址&gt;:FTP端口
在弹出的登录身份对话框中，输入已设置的FTP用户名和密码，然后单击登录。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ftp_02.png" alt="ftp 02">
</div>
</div>
<div class="paragraph">
<p>登录后，您可以查看到FTP服务器指定目录下的文件，例如：测试文件testfile.txt。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ftp_03.png" alt="ftp 03">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gost">35. gost</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_国外服务器">35.1. 国外服务器</h3>
<div class="ulist">
<ul>
<li>
<p>操作系统：centos-stream 9</p>
</li>
<li>
<p>内存：2G</p>
</li>
<li>
<p>cpu: 2</p>
</li>
<li>
<p>ip:  47.242.55.180</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>1.国外服务器安装gost</p>
</div>
<div class="listingblock">
<div class="title">安装GOST</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~
wget https://github.com/go-gost/gost/releases/download/v3.0.0-rc6/gost_3.0.0-rc6_linux_amd64v3.tar.gz -O gost_3.0.0-rc6_linux_amd64v3.tar.gz
tar xf gost_3.0.0-rc6_linux_amd64v3.tar.gz -C /usr/local/bin
ls -l /usr/local/bin/gost

gost -h</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
老旧CPU使用 gost_3.0.0-rc6_linux_amd64.tar.gz 代替（不带v3标识）
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>2.国外服务器隧道搭建</p>
</div>
<div class="listingblock">
<div class="title">创建系统服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt; EOF &gt; /etc/gost.yaml
services:
- name: gost-relay-service
  addr: :35462
  handler:
    type: relay
    auth:
      username:
      password: eethi6ohjuuQueen3omu
  listener:
    type: tls

log:
  level: info
  format: text
  output: /var/log/gost/error.log
  rotation:
    maxSize: 100
    maxAge: 4
    maxBackups: 3
    localTime: true
    compress: true
EOF

cat &lt;&lt; EOF &gt; /usr/lib/systemd/system/gost.service
[Unit]
Description=GO Simple Tunnel
After=network.target remote-fs.target nss-lookup.target

[Service]
Type=simple
ExecStart=/usr/local/bin/gost -C /etc/gost.yaml

[Install]
WantedBy=multi-user.target
EOF

systemctl enable gost
systemctl start gost
systemctl status gost</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果购买的是阿里云的服务器，需要修改安全组，否则35462端口不能访问。</p>
</div>
<div class="paragraph">
<p>修改教程：
<a href="https://developer.aliyun.com/article/1209354" class="bare">https://developer.aliyun.com/article/1209354</a></p>
</div>
<div class="paragraph">
<p>配置结果：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gost_02.png" alt="gost 02">
</div>
</div>
<div class="paragraph">
<p>修改安全组规则后无须restart gost也能生效。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在本例中</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">IP地址</dt>
<dd>
<p>47.242.55.180</p>
</dd>
<dt class="hdlist1">隧道协议</dt>
<dd>
<p>Relay</p>
</dd>
<dt class="hdlist1">数据通道</dt>
<dd>
<p>TLS</p>
</dd>
<dt class="hdlist1">隧道端口</dt>
<dd>
<p>35462</p>
</dd>
<dt class="hdlist1">隧道密码</dt>
<dd>
<p>eethi6ohjuuQueen3omu</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_落地客户端">35.2. 落地客户端</h3>
<div class="ulist">
<ul>
<li>
<p>操作系统：centos-stream 9</p>
</li>
<li>
<p>内存：2G</p>
</li>
<li>
<p>cpu: 2</p>
</li>
<li>
<p>ip: 192.168.182.128</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>1.在落地客户端(本地虚拟机)安装GOST</p>
</div>
<div class="paragraph">
<p>由于本地虚拟机访问github很慢，所以直接将国外服务器上的文件传输到本地</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~
scp root@47.242.55.180:~/gost_3.0.0-rc6_linux_amd64v3.tar.gz .
tar xf gost_3.0.0-rc6_linux_amd64v3.tar.gz -C /usr/local/bin
ls -l /usr/local/bin/gost

gost -h</code></pre>
</div>
</div>
<div class="paragraph">
<p>2.创建系统服务</p>
</div>
<div class="listingblock">
<div class="title">创建系统服务</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#下面ip:47.242.55.180仅适用本例,自己配置时应改为自己国外服务器的ip
cat &lt;&lt; EOF &gt; /usr/lib/systemd/system/gost.service
[Unit]
Description=GO Simple Tunnel
After=network.target remote-fs.target nss-lookup.target

[Service]
Type=simple
ExecStart=/usr/local/bin/gost -L=socks5://:1080 -F=relay+tls://:eethi6ohjuuQueen3omu@47.242.55.180:35462

[Install]
WantedBy=multi-user.target
EOF

systemctl stop firewalld
systemctl disable firewalld
systemctl status firewalld

systemctl enable gost
systemctl start gost
systemctl status gost</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">隧道协议</dt>
<dd>
<p>Socks5</p>
</dd>
<dt class="hdlist1">服务器ip</dt>
<dd>
<p>192.168.182.128</p>
</dd>
<dt class="hdlist1">隧道端口</dt>
<dd>
<p>1080</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>在chrome浏览器安装SwitchyOmega插件，并新建情景模式，配置代理协议如下</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/gost_01.png" alt="gost 01">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Misc_chapter">36. 杂项</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_chrome">36.1. Chrome</h3>
<div class="sect3">
<h4 id="_安装_proxy_switchyomega_扩展">36.1.1. 安装 Proxy SwitchyOmega 扩展</h4>
<div class="paragraph">
<p>安装 <code>Proxy SwitchyOmega</code> 之前，需要访问Google应用商店，让Chrome挂全局代理：</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Linux</dt>
<dd>
<p>google-chrome-stable --proxy-server="socks5://192.168.1.5:1080"</p>
</dd>
<dt class="hdlist1">Windows</dt>
<dd>
<p><code>Google Chrome</code> 快捷方式的属性中，追加程序运行参数，得到 <code>"C:\xxxx\chrome.exe" --proxy-server="socks5://192.168.1.5:1080"</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>然后，安装扩展 <a href="https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?hl=zh-CN">Proxy SwitchyOmega</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_switchyomega实现自动代理切换">36.1.2. SwitchyOmega实现自动代理切换</h4>
<div class="ulist">
<ul>
<li>
<p>Reference: <a href="https://www.itfanr.cc/2019/09/04/autoproxy-by-shadowsocks-and-switchyomega/" class="bare">https://www.itfanr.cc/2019/09/04/autoproxy-by-shadowsocks-and-switchyomega/</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_辨别虚拟机物理机">36.2. 辨别虚拟机物理机</h3>
<div class="ulist">
<ul>
<li>
<p>Reference:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.aliyun.com/article/249564" class="bare">https://developer.aliyun.com/article/249564</a></p>
</li>
<li>
<p><a href="https://unix.stackexchange.com/questions/89714/easy-way-to-determine-the-virtualization-technology-of-a-linux-machine" class="bare">https://unix.stackexchange.com/questions/89714/easy-way-to-determine-the-virtualization-technology-of-a-linux-machine</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_linux">36.2.1. linux</h4>
<div class="listingblock">
<div class="title">VMware Workstation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">root@router:~# dmidecode -s system-product-name
VMware Virtual Platform</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">VirtualBox</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">root@router:~# dmidecode -s system-product-name
VirtualBox</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Qemu with KVM</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">root@router:~# dmidecode -s system-product-name
KVM</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Qemu (emulated)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">root@router:~# dmidecode -s system-product-name
Bochs</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Microsoft VirtualPC</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">root@router:~# dmidecode | egrep -i 'manufacturer|product'
Manufacturer: Microsoft Corporation
Product Name: Virtual Machine</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Virtuozzo</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">root@router:~# dmidecode
/dev/mem: Permission denied</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Xen</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">root@router:~# dmidecode | grep -i domU
Product Name: HVM domU</code></pre>
</div>
</div>
<div class="paragraph">
<p>在裸机上，这会返回计算机或主板型号的标识。</p>
</div>
<div class="paragraph">
<p>如果您无权运行 dmidecode 那么您可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ls -1 /dev/disk/by-id/</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">输出</div>
<div class="content">
<pre>[root@host-7-129 ~]# ls -1 /dev/disk/by-id/
ata-QEMU_DVD-ROM_QM00003
ata-QEMU_HARDDISK_QM00001
ata-QEMU_HARDDISK_QM00001-part1
ata-QEMU_HARDDISK_QM00002
ata-QEMU_HARDDISK_QM00002-part1
scsi-SATA_QEMU_HARDDISK_QM00001
scsi-SATA_QEMU_HARDDISK_QM00001-part1
scsi-SATA_QEMU_HARDDISK_QM00002
scsi-SATA_QEMU_HARDDISK_QM00002-part1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_windows">36.2.2. windows</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Systeminfo | findstr /i "System Model"</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果System Model：后面含有Virutal就是虚拟机，其他都是物理机</p>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-01-15 14:17:11 +0800
</div>
</div>
<script src="js/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="js/MathJax/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>